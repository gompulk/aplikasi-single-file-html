<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KopiKu - Coffee Shop Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Variabel Warna Global untuk Tema */
        :root {
            --theme-primary: #8B5CF6; /* ungu */
            --theme-primary-hover: #7C3AED;
            --theme-text: #8B5CF6;
            --theme-gradient-from: #8B5CF6;
            --theme-gradient-to: #2563EB;
        }

        /* Kelas utilitas baru untuk menggunakan variabel tema */
        .bg-theme-primary { background-color: var(--theme-primary); }
        .hover\:bg-theme-primary-hover:hover { background-color: var(--theme-primary-hover); }
        .text-theme-primary { color: var(--theme-text); }
        .border-theme-primary { border-color: var(--theme-primary); }
        .gradient-theme { background-image: linear-gradient(to right, var(--theme-gradient-from), var(--theme-gradient-to)); }


        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .slide-in { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateY(-10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .hover-scale { transition: transform 0.2s; }
        .hover-scale:hover { transform: scale(1.02); }
        .loading-spinner { border: 3px solid #f3f3f3; border-top: 3px solid var(--theme-primary); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .print-only { display: none; }
        @media print { .print-only { display: block; } .no-print { display: none; } }
    </style>
</head>
<body class="bg-gray-50">
    <div id="loadingScreen" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-gray-600">Memuat aplikasi...</p>
        </div>
    </div>

    <div id="app" class="min-h-screen">
        <header class="bg-white shadow-lg sticky top-0 z-40">
            <div class="container mx-auto px-4 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-coffee text-theme-primary text-2xl"></i>
                        <h1 class="text-xl md:text-2xl font-bold text-gray-800" id="merchantName">KopiKu Coffee Shop</h1>
                    </div>
                    <nav class="hidden md:flex items-center space-x-4">
                        <button onclick="showPage('home')" class="nav-btn text-gray-600 hover:text-theme-primary transition">
                            <i class="fas fa-home mr-2"></i>Beranda
                        </button>
                        <button onclick="showPage('menu')" class="nav-btn text-gray-600 hover:text-theme-primary transition">
                            <i class="fas fa-coffee mr-2"></i>Menu
                        </button>
                        <button onclick="showPage('queue')" class="nav-btn text-gray-600 hover:text-theme-primary transition">
                            <i class="fas fa-users mr-2"></i>Antrian
                        </button>
                        <button onclick="showPage('contact')" class="nav-btn text-gray-600 hover:text-theme-primary transition">
                            <i class="fas fa-phone mr-2"></i>Kontak
                        </button>
                        <button onclick="showLoginModal()" class="bg-theme-primary text-white px-4 py-2 rounded-lg hover:bg-theme-primary-hover transition">
                            <i class="fas fa-user-shield mr-2"></i>Admin
                        </button>
                    </nav>
                    <div class="md:hidden">
                         <button onclick="showLoginModal()" class="bg-theme-primary text-white px-3 py-2 rounded-lg hover:bg-theme-primary-hover transition">
                            <i class="fas fa-user-shield"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <section id="jumbotron" class="relative gradient-theme text-white py-20">
            <div class="container mx-auto px-4 text-center">
                <h2 class="text-4xl md:text-5xl font-bold mb-4" id="jumbotronTitle">Selamat Datang di KopiKu</h2>
                <p class="text-lg md:text-xl mb-8" id="jumbotronSubtitle">Nikmati kopi terbaik dengan suasana yang nyaman</p>
                <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                    <button onclick="showPage('menu')" class="bg-white text-theme-primary px-8 py-3 rounded-full font-semibold hover:bg-gray-100 transition hover-scale">
                        <i class="fas fa-shopping-cart mr-2"></i>Pesan Sekarang
                    </button>
                    <button onclick="showPage('queue')" class="border-2 border-white text-white px-8 py-3 rounded-full font-semibold hover:bg-white hover:text-theme-primary transition hover-scale">
                        <i class="fas fa-users mr-2"></i>Lihat Antrian
                    </button>
                </div>
            </div>
        </section>

        <main class="container mx-auto px-4 py-8">
            <div id="homePage" class="page-content">
                <div class="grid md:grid-cols-3 gap-8 mb-12">
                    <div class="bg-white p-6 rounded-xl shadow-lg hover-scale">
                        <div class="text-theme-primary text-4xl mb-4">
                            <i class="fas fa-coffee"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-2">Kopi Premium</h3>
                        <p class="text-gray-600">100% kopi pilihan dengan kualitas terbaik</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg hover-scale">
                        <div class="text-theme-primary text-4xl mb-4">
                            <i class="fas fa-wifi"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-2">WiFi Gratis</h3>
                        <p class="text-gray-600">Nikmati koneksi internet cepat dan gratis</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg hover-scale">
                        <div class="text-theme-primary text-4xl mb-4">
                            <i class="fas fa-couch"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-2">Ruangan Nyaman</h3>
                        <p class="text-gray-600">Suasana cozy yang bikin betah berlama-lama</p>
                    </div>
                </div>

                <div class="mb-12">
                    <h2 class="text-3xl font-bold text-center mb-8">Produk Unggulan</h2>
                    <div id="featuredProducts" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6">
                        </div>
                </div>
            </div>

            <div id="menuPage" class="page-content hidden">
                <h2 class="text-3xl font-bold mb-8 text-center">Menu Kami</h2>
                
                <div class="flex justify-center mb-8">
                    <div class="bg-white rounded-lg shadow-md p-1 inline-flex flex-wrap">
                        <button onclick="filterProducts('all')" class="category-btn px-4 py-2 sm:px-6 rounded-md transition" data-category="all">Semua</button>
                        <button onclick="filterProducts('coffee')" class="category-btn px-4 py-2 sm:px-6 rounded-md transition" data-category="coffee">Kopi</button>
                        <button onclick="filterProducts('food')" class="category-btn px-4 py-2 sm:px-6 rounded-md transition" data-category="food">Makanan</button>
                        <button onclick="filterProducts('dessert')" class="category-btn px-4 py-2 sm:px-6 rounded-md transition" data-category="dessert">Dessert</button>
                        <button onclick="filterProducts('other')" class="category-btn px-4 py-2 sm:px-6 rounded-md transition" data-category="other">Lainnya</button>
                    </div>
                </div>

                <div id="productsGrid" class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6 mb-8">
                    </div>

                <button id="cartFab" onclick="showCartModal()" class="fixed bottom-20 md:bottom-8 right-8 bg-theme-primary text-white w-16 h-16 rounded-full shadow-lg flex items-center justify-center text-2xl hover:bg-theme-primary-hover transition z-30">
                    <i class="fas fa-shopping-cart"></i>
                    <span id="cartItemCountBadge" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full h-6 w-6 flex items-center justify-center hidden">0</span>
                </button>
            </div>

            <div id="queuePage" class="page-content hidden">
                <h2 class="text-3xl font-bold mb-8 text-center">Antrian Saat Ini</h2>
                <div id="queueList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    </div>
            </div>

            <div id="contactPage" class="page-content hidden">
                <div class="max-w-4xl mx-auto">
                    <h2 class="text-3xl font-bold mb-8 text-center">Hubungi Kami</h2>
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-semibold mb-4">Informasi Kontak</h3>
                            <div class="space-y-3">
                                <div class="flex items-center">
                                    <i class="fas fa-map-marker-alt text-theme-primary w-6"></i>
                                    <span id="contactAddress">Jl. Contoh No. 123, Jakarta</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-phone text-theme-primary w-6"></i>
                                    <span id="contactPhone">+62 812-3456-7890</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-envelope text-theme-primary w-6"></i>
                                    <span id="contactEmail">info@kopiku.com</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-clock text-theme-primary w-6"></i>
                                    <span id="contactHours">Senin - Minggu: 08:00 - 22:00</span>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-semibold mb-4">Kirim Pesan</h3>
                            <form onsubmit="sendContactMessage(event)" class="space-y-4">
                                <input type="text" placeholder="Nama Anda" class="w-full p-3 border rounded-lg" required>
                                <input type="email" placeholder="Email Anda" class="w-full p-3 border rounded-lg" required>
                                <textarea placeholder="Pesan Anda" rows="4" class="w-full p-3 border rounded-lg" required></textarea>
                                <button type="submit" class="w-full bg-theme-primary text-white py-3 rounded-lg hover:bg-theme-primary-hover transition">
                                    <i class="fas fa-paper-plane mr-2"></i>Kirim Pesan
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
             <div class="md:hidden fixed bottom-0 left-0 right-0 bg-white shadow-lg z-40">
                <nav class="flex justify-around py-2">
                    <button onclick="showPage('home')" class="nav-btn flex flex-col items-center text-gray-600 hover:text-theme-primary transition">
                        <i class="fas fa-home text-xl"></i><span class="text-xs">Beranda</span>
                    </button>
                    <button onclick="showPage('menu')" class="nav-btn flex flex-col items-center text-gray-600 hover:text-theme-primary transition">
                        <i class="fas fa-coffee text-xl"></i><span class="text-xs">Menu</span>
                    </button>
                    <button onclick="showPage('queue')" class="nav-btn flex flex-col items-center text-gray-600 hover:text-theme-primary transition">
                        <i class="fas fa-users text-xl"></i><span class="text-xs">Antrian</span>
                    </button>
                    <button onclick="showPage('contact')" class="nav-btn flex flex-col items-center text-gray-600 hover:text-theme-primary transition">
                        <i class="fas fa-phone text-xl"></i><span class="text-xs">Kontak</span>
                    </button>
                </nav>
            </div>
        </main>

        <footer class="bg-gray-800 text-white py-8 mt-16 pb-20 md:pb-8">
            <div class="container mx-auto px-4 text-center">
                <p>&copy; 2025 <span id="footerMerchantName">KopiKu</span>. All rights reserved.</p>
                <div class="mt-4 flex justify-center space-x-4">
                    <a href="#" class="hover:text-theme-primary transition"><i class="fab fa-facebook"></i></a>
                    <a href="#" class="hover:text-theme-primary transition"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="hover:text-theme-primary transition"><i class="fab fa-twitter"></i></a>
                </div>
            </div>
        </footer>
    </div>

    <div id="cartModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl p-6 w-full max-w-sm slide-in">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">Keranjang</h2>
                <button onclick="closeCartModal()" class="text-2xl text-gray-500 hover:text-gray-800">&times;</button>
            </div>
            <div id="modalCartItems" class="mb-4 max-h-64 overflow-y-auto pr-2">
                </div>
            <div class="border-t pt-4">
                <div class="flex justify-between font-bold text-lg mb-4">
                    <span>Total</span>
                    <span id="modalCartTotal">Rp 0</span>
                </div>
                <div class="flex space-x-4">
                    <button onclick="closeCartModal()" class="flex-1 bg-gray-300 text-gray-800 py-3 rounded-lg hover:bg-gray-400 transition">
                        Tutup
                    </button>
                    <button onclick="proceedToCheckout()" class="flex-1 bg-theme-primary text-white py-3 rounded-lg hover:bg-theme-primary-hover transition">
                        Checkout
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl p-8 w-full max-w-sm slide-in">
            <h2 class="text-2xl font-bold mb-6 text-center">Login Admin</h2>
            <form onsubmit="handleLogin(event)" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Username</label>
                    <input type="text" id="loginUsername" class="w-full p-3 border rounded-lg" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Password</label>
                    <input type="password" id="loginPassword" class="w-full p-3 border rounded-lg" required>
                </div>
                <button type="submit" class="w-full bg-theme-primary text-white py-3 rounded-lg hover:bg-theme-primary-hover transition">
                    <i class="fas fa-sign-in-alt mr-2"></i>Login
                </button>
            </form>
            <button onclick="closeLoginModal()" class="w-full mt-4 text-gray-600 hover:text-gray-800 transition">
                Batal
            </button>
        </div>
    </div>

    <div id="checkoutModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl p-6 md:p-8 w-full max-w-2xl max-h-[90vh] overflow-y-auto slide-in">
            <h2 class="text-2xl font-bold mb-6">Checkout</h2>
            <form onsubmit="processCheckout(event)" class="space-y-4">
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Nama Lengkap</label>
                        <input type="text" id="customerName" class="w-full p-3 border rounded-lg" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Nomor Telepon</label>
                        <input type="tel" id="customerPhone" class="w-full p-3 border rounded-lg" required>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Email (Opsional)</label>
                    <input type="email" id="customerEmail" class="w-full p-3 border rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Metode Pembayaran</label>
                    <div id="paymentMethods" class="grid grid-cols-2 gap-4">
                        </div>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Catatan (Opsional)</label>
                    <textarea id="orderNotes" rows="3" class="w-full p-3 border rounded-lg"></textarea>
                </div>
                <div class="border-t pt-4">
                    <div class="flex justify-between text-lg md:text-xl font-bold mb-4">
                        <span>Total Pembayaran:</span>
                        <span id="checkoutTotal">Rp 0</span>
                    </div>
                    <div class="flex space-x-4">
                        <button type="button" onclick="closeCheckoutModal()" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400 transition">
                            Batal
                        </button>
                        <button type="submit" class="flex-1 bg-theme-primary text-white py-3 rounded-lg hover:bg-theme-primary-hover transition">
                            <i class="fas fa-check mr-2"></i>Proses Pesanan
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div id="adminPanel" class="fixed inset-0 bg-gray-100 z-50 hidden">
        <div class="flex h-screen relative">
            <div id="adminSidebar" class="absolute inset-y-0 left-0 w-64 bg-gray-800 text-white transform -translate-x-full md:relative md:translate-x-0 transition-transform duration-300 ease-in-out z-30">
                <div class="p-4">
                    <h2 class="text-xl font-bold mb-6">Admin Panel</h2>
                    <nav class="space-y-2">
                        <button onclick="showAdminSection('dashboard')" class="admin-nav-btn w-full text-left p-3 rounded hover:bg-gray-700 transition">
                            <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
                        </button>
                        <button onclick="showAdminSection('orders')" class="admin-nav-btn w-full text-left p-3 rounded hover:bg-gray-700 transition">
                            <i class="fas fa-shopping-cart mr-2"></i>Pesanan
                        </button>
                        <button onclick="showAdminSection('queue')" class="admin-nav-btn w-full text-left p-3 rounded hover:bg-gray-700 transition">
                            <i class="fas fa-users mr-2"></i>Antrian
                        </button>
                        <button onclick="showAdminSection('products')" class="admin-nav-btn w-full text-left p-3 rounded hover:bg-gray-700 transition">
                            <i class="fas fa-box mr-2"></i>Produk
                        </button>
                        <button onclick="showAdminSection('users')" class="admin-nav-btn w-full text-left p-3 rounded hover:bg-gray-700 transition">
                            <i class="fas fa-user-cog mr-2"></i>Pengguna
                        </button>
                        <button onclick="showAdminSection('settings')" class="admin-nav-btn w-full text-left p-3 rounded hover:bg-gray-700 transition">
                            <i class="fas fa-cog mr-2"></i>Pengaturan
                        </button>
                        <button onclick="showAdminSection('reports')" class="admin-nav-btn w-full text-left p-3 rounded hover:bg-gray-700 transition">
                            <i class="fas fa-chart-bar mr-2"></i>Laporan
                        </button>
                        <button onclick="downloadDatabase()" class="admin-nav-btn w-full text-left p-3 rounded hover:bg-gray-700 transition">
                            <i class="fas fa-download mr-2"></i>Download DB
                        </button>
                        <button onclick="logoutAdmin()" class="admin-nav-btn w-full text-left p-3 rounded hover:bg-red-600 transition">
                            <i class="fas fa-sign-out-alt mr-2"></i>Logout
                        </button>
                    </nav>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto">
                 <div class="md:hidden bg-white shadow-md p-4 flex justify-between items-center sticky top-0 z-20">
                    <button id="sidebarToggle" class="text-gray-800">
                        <i class="fas fa-bars fa-lg"></i>
                    </button>
                    <h1 class="font-bold text-lg" id="adminSectionTitle">Dashboard</h1>
                </div>

                <div class="p-6">
                    <div id="adminDashboard" class="admin-section">
                        <h1 class="text-3xl font-bold mb-6 hidden md:block">Dashboard</h1>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                           <div class="bg-white p-6 rounded-lg shadow">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-600">Total Pesanan</p>
                                        <p class="text-2xl font-bold" id="totalOrders">0</p>
                                    </div>
                                    <i class="fas fa-shopping-cart text-theme-primary text-2xl"></i>
                                </div>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-600">Antrian Aktif</p>
                                        <p class="text-2xl font-bold" id="activeQueue">0</p>
                                    </div>
                                    <i class="fas fa-users text-blue-600 text-2xl"></i>
                                </div>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-600">Total Produk</p>
                                        <p class="text-2xl font-bold" id="totalProducts">0</p>
                                    </div>
                                    <i class="fas fa-box text-green-600 text-2xl"></i>
                                </div>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-600">Pendapatan</p>
                                        <p class="text-2xl font-bold" id="totalRevenue">Rp 0</p>
                                    </div>
                                    <i class="fas fa-money-bill text-yellow-600 text-2xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="adminOrders" class="admin-section hidden">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-3xl font-bold hidden md:block">Manajemen Pesanan</h1>
                            <button onclick="exportOrdersReport()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition text-sm">
                                <i class="fas fa-file-excel mr-2"></i>Export
                            </button>
                        </div>
                        <div class="bg-white rounded-lg shadow overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">No. Pesanan</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Pelanggan</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Total</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="ordersTable" class="bg-white divide-y divide-gray-200">
                                    </tbody>
                            </table>
                        </div>
                    </div>

                    <div id="adminQueue" class="admin-section hidden">
                        <h1 class="text-3xl font-bold mb-6 hidden md:block">Manajemen Antrian</h1>
                        <div id="adminQueueList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            </div>
                    </div>

                    <div id="adminProducts" class="admin-section hidden">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-3xl font-bold hidden md:block">Manajemen Produk</h1>
                            <button onclick="showProductModal()" class="bg-theme-primary text-white px-4 py-2 rounded-lg hover:bg-theme-primary-hover transition">
                                <i class="fas fa-plus mr-2"></i>Tambah
                            </button>
                        </div>
                        <div id="adminProductsList" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                            </div>
                    </div>

                    <div id="adminUsers" class="admin-section hidden">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-3xl font-bold hidden md:block">Manajemen Pengguna</h1>
                            <button onclick="showUserModal()" class="bg-theme-primary text-white px-4 py-2 rounded-lg hover:bg-theme-primary-hover transition">
                                <i class="fas fa-plus mr-2"></i>Tambah
                            </button>
                        </div>
                        <div class="bg-white rounded-lg shadow overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nama</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Username</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Role</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTable" class="bg-white divide-y divide-gray-200">
                                    </tbody>
                            </table>
                        </div>
                    </div>

                    <div id="adminSettings" class="admin-section hidden">
                        <h1 class="text-3xl font-bold mb-6 hidden md:block">Pengaturan</h1>
                        <div class="bg-white rounded-lg shadow p-6">
                            <form onsubmit="saveSettings(event)" class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Nama Merchant</label>
                                    <input type="text" id="settingsMerchantName" class="w-full p-3 border rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Jumbotron Title</label>
                                    <input type="text" id="settingsJumbotronTitle" class="w-full p-3 border rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Jumbotron Subtitle</label>
                                    <input type="text" id="settingsJumbotronSubtitle" class="w-full p-3 border rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Alamat</label>
                                    <input type="text" id="settingsAddress" class="w-full p-3 border rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Telepon</label>
                                    <input type="text" id="settingsPhone" class="w-full p-3 border rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Email</label>
                                    <input type="email" id="settingsEmail" class="w-full p-3 border rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Jam Operasional</label>
                                    <input type="text" id="settingsHours" class="w-full p-3 border rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Metode Pembayaran Aktif</label>
                                    <div id="settingsPaymentMethods" class="space-y-2">
                                        </div>
                                </div>

                                <div class="border-t pt-6">
                                    <label class="block text-lg font-semibold mb-4">Tema Warna</label>
                                    <div class="flex flex-wrap items-center gap-4">
                                        <button type="button" onclick="applyTheme('purple')" class="w-8 h-8 rounded-full bg-purple-500 border-2 border-white shadow"></button>
                                        <button type="button" onclick="applyTheme('brown')" class="w-8 h-8 rounded-full bg-amber-700 border-2 border-white shadow"></button>
                                        <button type="button" onclick="applyTheme('red')" class="w-8 h-8 rounded-full bg-red-600 border-2 border-white shadow"></button>
                                        <button type="button" onclick="applyTheme('black')" class="w-8 h-8 rounded-full bg-gray-800 border-2 border-white shadow"></button>
                                        
                                        <div class="relative">
                                            <label for="customColorPicker" class="cursor-pointer">
                                                <div class="w-8 h-8 rounded-full border-2 border-white shadow flex items-center justify-center bg-gray-200">
                                                    <i class="fas fa-palette"></i>
                                                </div>
                                                <input type="color" id="customColorPicker" class="absolute top-0 left-0 w-full h-full opacity-0 cursor-pointer">
                                            </label>
                                            <span class="ml-2 text-sm text-gray-600">Kustom</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <button type="submit" class="bg-theme-primary text-white px-6 py-3 rounded-lg hover:bg-theme-primary-hover transition">
                                    <i class="fas fa-save mr-2"></i>Simpan Pengaturan
                                </button>
                            </form>
                        </div>
                    </div>

                    <div id="adminReports" class="admin-section hidden">
                        <div class="flex flex-col md:flex-row justify-between md:items-center mb-6 gap-4">
                            <h1 class="text-3xl font-bold hidden md:block">Laporan</h1>
                            <div class="flex flex-wrap gap-2">
                                <input type="date" id="reportStartDate" class="p-2 border rounded-lg">
                                <input type="date" id="reportEndDate" class="p-2 border rounded-lg">
                                <button onclick="generateReport()" class="bg-theme-primary text-white px-4 py-2 rounded-lg hover:bg-theme-primary-hover transition">
                                    <i class="fas fa-search mr-2"></i>Generate
                                </button>
                                <button onclick="printReport()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">
                                    <i class="fas fa-print mr-2"></i>Print
                                </button>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg shadow p-6">
                            <div id="reportContent">
                                </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="productModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl p-6 md:p-8 w-full max-w-2xl slide-in max-h-[90vh] overflow-y-auto">
            <h2 class="text-2xl font-bold mb-6" id="productModalTitle">Tambah Produk</h2>
            <form onsubmit="saveProduct(event)" class="space-y-4">
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Nama Produk</label>
                        <input type="text" id="productName" class="w-full p-3 border rounded-lg" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Kategori</label>
                        <select id="productCategory" class="w-full p-3 border rounded-lg" required>
                            <option value="coffee">Kopi</option>
                            <option value="food">Makanan</option>
                            <option value="dessert">Dessert</option>
                            <option value="other">Lainnya</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Deskripsi</label>
                    <textarea id="productDescription" rows="3" class="w-full p-3 border rounded-lg"></textarea>
                </div>
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Harga</label>
                        <input type="number" id="productPrice" class="w-full p-3 border rounded-lg" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Status</label>
                        <select id="productStatus" class="w-full p-3 border rounded-lg">
                            <option value="true">Tersedia</option>
                            <option value="false">Tidak Tersedia</option>
                        </select>
                    </div>
                </div>
                <div class="flex space-x-4">
                    <button type="button" onclick="closeProductModal()" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400 transition">
                        Batal
                    </button>
                    <button type="submit" class="flex-1 bg-theme-primary text-white py-3 rounded-lg hover:bg-theme-primary-hover transition">
                        <i class="fas fa-save mr-2"></i>Simpan
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="userModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl p-8 w-full max-w-md slide-in">
            <h2 class="text-2xl font-bold mb-6" id="userModalTitle">Tambah Admin</h2>
            <form onsubmit="saveUser(event)" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Nama Lengkap</label>
                    <input type="text" id="userFullName" class="w-full p-3 border rounded-lg" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Username</label>
                    <input type="text" id="userUsername" class="w-full p-3 border rounded-lg" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Password</label>
                    <input type="password" id="userPassword" class="w-full p-3 border rounded-lg" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Role</label>
                    <select id="userRole" class="w-full p-3 border rounded-lg">
                        <option value="admin">Admin</option>
                        <option value="superadmin">Super Admin</option>
                    </select>
                </div>
                <div class="flex space-x-4">
                    <button type="button" onclick="closeUserModal()" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400 transition">
                        Batal
                    </button>
                    <button type="submit" class="flex-1 bg-theme-primary text-white py-3 rounded-lg hover:bg-theme-primary-hover transition">
                        <i class="fas fa-save mr-2"></i>Simpan
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="toast" class="fixed bottom-24 md:bottom-4 right-4 z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl p-4 flex items-center space-x-3 slide-in">
            <div id="toastIcon"></div>
            <div>
                <p id="toastTitle" class="font-semibold"></p>
                <p id="toastMessage" class="text-sm text-gray-600"></p>
            </div>
        </div>
    </div>

    <script>
        // ... (Sisa kode dari `class Database` hingga akhir disalin dari file sebelumnya, dengan fungsi tema yang sudah ditambahkan)
        // Pastikan semua kode JavaScript Anda ada di sini.
        class Database {
            constructor() { this.initializeDatabase(); }
            initializeDatabase() {
                if (!localStorage.getItem('kopiku_database')) {
                    const initialData = {
                        settings: {
                            merchantName: 'KopiKu Coffee Shop',
                            jumbotronTitle: 'Selamat Datang di KopiKu',
                            jumbotronSubtitle: 'Nikmati kopi terbaik dengan suasana yang nyaman',
                            address: 'Jl. Contoh No. 123, Jakarta',
                            phone: '+62 812-3456-7890',
                            email: 'info@kopiku.com',
                            hours: 'Senin - Minggu: 08:00 - 22:00',
                            paymentMethods: [
                                { id: 'cash', name: 'Tunai', icon: 'fa-money-bill', active: true },
                                { id: 'qris', name: 'QRIS', icon: 'fa-qrcode', active: true },
                                { id: 'transfer', name: 'Transfer Bank', icon: 'fa-university', active: false }
                            ],
                            theme: 'purple' // Default theme
                        },
                        products: [
                            { id: 1, name: 'Espresso', category: 'coffee', description: 'Kopi klasik yang kuat', price: 15000, available: true },
                            { id: 2, name: 'Cappuccino', category: 'coffee', description: 'Espresso dengan susu foam', price: 25000, available: true },
                            { id: 3, name: 'Caffe Latte', category: 'coffee', description: 'Espresso dengan susu panas', price: 28000, available: true },
                            { id: 4, name: 'Americano', category: 'coffee', description: 'Espresso dengan air panas', price: 20000, available: true },
                            { id: 5, name: 'Chocolate Cake', category: 'dessert', description: 'Kue coklat lembut', price: 30000, available: true },
                            { id: 6, name: 'Croissant', category: 'food', description: 'Pastry buttery dari Perancis', price: 22000, available: true },
                            { id: 7, name: 'Sandwich', category: 'food', description: 'Roti lapis dengan isi', price: 35000, available: true },
                            { id: 8, name: 'Ice Cream', category: 'dessert', description: 'Es krim premium', price: 18000, available: true }
                        ],
                        orders: [],
                        queue: [],
                        users: [ { id: 1, username: 'admin', password: 'admin123', fullName: 'Administrator', role: 'admin' } ],
                        messages: []
                    };
                    localStorage.setItem('kopiku_database', JSON.stringify(initialData));
                }
            }
            getData() { return JSON.parse(localStorage.getItem('kopiku_database')); }
            saveData(data) { localStorage.setItem('kopiku_database', JSON.stringify(data)); }
        }

        const db = new Database();
        let currentUser = null;
        let cart = [];
        let currentFilter = 'all';
        let editingProductId = null;
        let editingUserId = null;

        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
                initializeApp();
            }, 1000);
            
            const sidebar = document.getElementById('adminSidebar');
            const toggleButton = document.getElementById('sidebarToggle');
            const adminContent = document.querySelector('#adminPanel .flex-1.overflow-y-auto');
            if (toggleButton) {
                toggleButton.addEventListener('click', (event) => {
                    event.stopPropagation();
                    sidebar.classList.toggle('-translate-x-full');
                });
            }
            if(adminContent) {
                adminContent.addEventListener('click', () => {
                    if (window.innerWidth < 768 && !sidebar.classList.contains('-translate-x-full')) {
                        sidebar.classList.add('-translate-x-full');
                    }
                });
            }

            const customColorPicker = document.getElementById('customColorPicker');
            if (customColorPicker) {
                customColorPicker.addEventListener('input', (event) => {
                    applyCustomTheme(event.target.value);
                });
            }
        });

        function initializeApp() {
            loadTheme();
            loadSettings();
            loadProducts();
            loadQueue();
            updateCart();
            setActiveNav('home');
        }

        const themes = {
            purple: { primary: '#8B5CF6', hover: '#7C3AED', text: '#8B5CF6', from: '#8B5CF6', to: '#2563EB' },
            brown: { primary: '#a16207', hover: '#854d0e', text: '#a16207', from: '#a16207', to: '#b45309' },
            red: { primary: '#dc2626', hover: '#b91c1c', text: '#dc2626', from: '#dc2626', to: '#ef4444' },
            black: { primary: '#1f2937', hover: '#111827', text: '#1f2937', from: '#1f2937', to: '#4b5563' }
        };

        function setCssVariables(colors) {
            const root = document.documentElement;
            root.style.setProperty('--theme-primary', colors.primary);
            root.style.setProperty('--theme-primary-hover', colors.hover);
            root.style.setProperty('--theme-text', colors.text);
            root.style.setProperty('--theme-gradient-from', colors.from);
            root.style.setProperty('--theme-gradient-to', colors.to);
        }

        function applyTheme(themeName) {
            const themeColors = themes[themeName];
            if (themeColors) {
                setCssVariables(themeColors);
                const data = db.getData();
                data.settings.theme = themeName;
                db.saveData(data);
            }
        }
        
        function generateColorShades(hex) {
            let r = parseInt(hex.slice(1, 3), 16), g = parseInt(hex.slice(3, 5), 16), b = parseInt(hex.slice(5, 7), 16);
            const darken = (c) => Math.max(0, Math.floor(c * 0.85)).toString(16).padStart(2, '0');
            const shift = (c1, c2) => Math.min(255, Math.floor(c1 * 1.2 + c2 * 0.2)).toString(16).padStart(2, '0');
            return {
                primary: hex,
                hover: `#${darken(r)}${darken(g)}${darken(b)}`,
                text: hex,
                from: hex,
                to: `#${shift(r,b)}${shift(g,r)}${shift(b,g)}`
            };
        }

        function applyCustomTheme(hexColor) {
            const shades = generateColorShades(hexColor);
            setCssVariables(shades);
            const data = db.getData();
            data.settings.theme = hexColor;
            db.saveData(data);
        }

        function loadTheme() {
            const data = db.getData();
            if(!data.settings.theme) data.settings.theme = 'purple'; // Fallback
            const savedTheme = data.settings.theme;
            if (savedTheme.startsWith('#')) {
                applyCustomTheme(savedTheme);
                document.getElementById('customColorPicker').value = savedTheme;
            } else {
                applyTheme(savedTheme);
            }
        }
        // ... (Sisa kode dari file asli tetap sama)
        // Salin dan tempel semua fungsi dari `showPage` hingga akhir di sini.
        function showPage(pageId) {
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.add('hidden');
            });
            document.getElementById(pageId + 'Page').classList.remove('hidden');
            document.body.scrollTop = 0; // For Safari
            document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
            setActiveNav(pageId);
        }

        function setActiveNav(pageId) {
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-theme-primary');
                btn.classList.add('text-gray-600');

                // For Mobile Nav
                if (btn.querySelector('span')) {
                    const mobilePageId = btn.querySelector('span').textContent.toLowerCase();
                     if(mobilePageId.includes(pageId) || (pageId === 'home' && mobilePageId.includes('beranda'))) {
                        btn.classList.remove('text-gray-600');
                        btn.classList.add('text-theme-primary');
                     }
                } 
                // For Desktop Nav
                else {
                    if (btn.textContent.toLowerCase().includes(pageId) || 
                        (pageId === 'home' && btn.textContent.includes('Beranda')) ||
                        (pageId === 'menu' && btn.textContent.includes('Menu')) ||
                        (pageId === 'queue' && btn.textContent.includes('Antrian')) ||
                        (pageId === 'contact' && btn.textContent.includes('Kontak'))) {
                        btn.classList.remove('text-gray-600');
                        btn.classList.add('text-theme-primary');
                    }
                }
            });
        }

        function loadSettings() {
            const data = db.getData();
            const settings = data.settings;
            
            // ### PERUBAHAN DI SINI ###
            document.title = settings.merchantName;
            
            document.getElementById('merchantName').textContent = settings.merchantName;
            document.getElementById('jumbotronTitle').textContent = settings.jumbotronTitle;
            document.getElementById('jumbotronSubtitle').textContent = settings.jumbotronSubtitle;
            document.getElementById('contactAddress').textContent = settings.address;
            document.getElementById('contactPhone').textContent = settings.phone;
            document.getElementById('contactEmail').textContent = settings.email;
            document.getElementById('contactHours').textContent = settings.hours;
            document.getElementById('footerMerchantName').textContent = settings.merchantName;
        }

        function loadProducts() {
            const data = db.getData();
            const products = data.products;
            
            // Load featured products
            const featuredContainer = document.getElementById('featuredProducts');
            featuredContainer.innerHTML = '';
            products.slice(0, 4).forEach(product => {
                featuredContainer.innerHTML += createProductCard(product);
            });
            
            // Load all products
            const productsContainer = document.getElementById('productsGrid');
            productsContainer.innerHTML = '';
            products.forEach(product => {
                productsContainer.innerHTML += createProductCard(product);
            });
        }

        function createProductCard(product) {
            return `
                <div class="bg-white rounded-lg shadow-lg overflow-hidden hover-scale product-card" data-category="${product.category}">
                    <div class="h-48 gradient-theme flex items-center justify-center">
                        <i class="fas fa-coffee text-white text-4xl"></i>
                    </div>
                    <div class="p-4">
                        <h3 class="font-semibold text-lg mb-2">${product.name}</h3>
                        <p class="text-gray-600 text-sm mb-3 h-10 overflow-hidden">${product.description}</p>
                        <div class="flex justify-between items-center">
                            <span class="text-theme-primary font-bold">Rp ${product.price.toLocaleString()}</span>
                            <button onclick="addToCart(${product.id})" class="bg-theme-primary text-white px-3 py-1 rounded-lg hover:bg-theme-primary-hover transition ${!product.available ? 'opacity-50 cursor-not-allowed' : ''}" ${!product.available ? 'disabled' : ''}>
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function filterProducts(category) {
            currentFilter = category;
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('bg-theme-primary', 'text-white');
                btn.classList.add('text-gray-600');
            });
            const activeBtn = document.querySelector(`[data-category="${category}"]`);
            activeBtn.classList.remove('text-gray-600');
            activeBtn.classList.add('bg-theme-primary', 'text-white');
        }

        function showCartModal() {
            const modal = document.getElementById('cartModal');
            const cartItemsContainer = document.getElementById('modalCartItems');
            const cartTotalEl = document.getElementById('modalCartTotal');
            
            if (cart.length === 0) {
                cartItemsContainer.innerHTML = '<p class="text-gray-500">Keranjang kosong</p>';
                cartTotalEl.textContent = 'Rp 0';
            } else {
                let html = '';
                let total = 0;
                cart.forEach(item => {
                    html += `
                        <div class="flex justify-between items-center mb-2">
                            <div class="flex-1">
                                <p class="font-semibold text-sm">${item.name}</p>
                                <p class="text-xs text-gray-600">Rp ${item.price.toLocaleString()} x ${item.quantity}</p>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button onclick="updateQuantity(${item.id}, -1, true)" class="text-red-500 hover:text-red-700">
                                    <i class="fas fa-minus-circle"></i>
                                </button>
                                <span class="text-sm">${item.quantity}</span>
                                <button onclick="updateQuantity(${item.id}, 1, true)" class="text-green-500 hover:text-green-700">
                                    <i class="fas fa-plus-circle"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    total += item.price * item.quantity;
                });
                cartItemsContainer.innerHTML = html;
                cartTotalEl.textContent = `Rp ${total.toLocaleString()}`;
            }

            modal.classList.remove('hidden');
        }

        function closeCartModal() {
            document.getElementById('cartModal').classList.add('hidden');
        }

        function proceedToCheckout() {
            if (cart.length === 0) {
                showToast('error', 'Error', 'Keranjang belanja kosong');
                return;
            }
            closeCartModal();
            showCheckoutModal();
        }

        function addToCart(productId) {
            const data = db.getData();
            const product = data.products.find(p => p.id === productId);
            if (!product || !product.available) return;
            
            const existingItem = cart.find(item => item.id === productId);
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({ ...product, quantity: 1 });
            }
            updateCart();
            showToast('success', 'Berhasil', 'Produk ditambahkan ke keranjang');
        }

        function updateCart() {
            const badge = document.getElementById('cartItemCountBadge');
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);

            if (totalItems > 0) {
                badge.textContent = totalItems;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }
        
        function updateQuantity(productId, change, isFromModal = false) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    cart = cart.filter(item => item.id !== productId);
                }
                updateCart();

                if (isFromModal) {
                    showCartModal();
                }
            }
        }

        function showCheckoutModal() {
            if (cart.length === 0) {
                showToast('error', 'Error', 'Keranjang belanja kosong');
                return;
            }
            
            const modal = document.getElementById('checkoutModal');
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            document.getElementById('checkoutTotal').textContent = `Rp ${total.toLocaleString()}`;
            
            const data = db.getData();
            const paymentMethods = document.getElementById('paymentMethods');
            paymentMethods.innerHTML = '';
            
            data.settings.paymentMethods.filter(pm => pm.active).forEach(method => {
                paymentMethods.innerHTML += `
                    <label class="flex items-center space-x-2 p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                        <input type="radio" name="paymentMethod" value="${method.id}" class="form-radio" required>
                        <i class="fas ${method.icon} text-theme-primary"></i>
                        <span>${method.name}</span>
                    </label>
                `;
            });
            
            modal.classList.remove('hidden');
        }

        function closeCheckoutModal() {
            document.getElementById('checkoutModal').classList.add('hidden');
        }

        function processCheckout(event) {
            event.preventDefault();
            
            const data = db.getData();
            const order = {
                id: Date.now(),
                orderNumber: `ORD${Date.now()}`,
                customerName: document.getElementById('customerName').value,
                customerPhone: document.getElementById('customerPhone').value,
                customerEmail: document.getElementById('customerEmail').value,
                paymentMethod: document.querySelector('input[name="paymentMethod"]:checked').value,
                notes: document.getElementById('orderNotes').value,
                items: [...cart],
                totalAmount: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                status: 'pending',
                createdAt: new Date().toISOString()
            };
            
            data.orders.push(order);
            
            if (order.paymentMethod === 'cash') {
                const queueItem = {
                    id: Date.now() + 1,
                    queueNumber: generateQueueNumber(),
                    orderId: order.id,
                    customerName: order.customerName,
                    customerPhone: order.customerPhone,
                    status: 'waiting',
                    createdAt: new Date().toISOString()
                };
                data.queue.push(queueItem);
                order.status = 'paid';
            }
            
            db.saveData(data);
            
            cart = [];
            updateCart();
            closeCheckoutModal();
            loadQueue();
            
            showToast('success', 'Berhasil', `Pesanan ${order.orderNumber} telah dibuat`);
        }

        function generateQueueNumber() {
            const data = db.getData();
            const lastQueue = data.queue.sort((a, b) => b.id - a.id)[0];
            if (!lastQueue) return 'A001';
            
            const lastNumber = parseInt(lastQueue.queueNumber.substring(1));
            return `A${String(lastNumber + 1).padStart(3, '0')}`;
        }

        function loadQueue() {
            const data = db.getData();
            const queue = data.queue.sort((a, b) => a.id - b.id);
            
            const queueList = document.getElementById('queueList');
            queueList.innerHTML = '';
            
            if (queue.length === 0) {
                queueList.innerHTML = '<p class="text-center text-gray-500 col-span-full">Tidak ada antrian saat ini</p>';
                return;
            }
            
            queue.forEach(item => {
                const statusColor = {
                    'waiting': 'bg-yellow-100 text-yellow-800',
                    'called': 'bg-blue-100 text-blue-800',
                    'completed': 'bg-green-100 text-green-800',
                    'cancelled': 'bg-red-100 text-red-800'
                }[item.status] || 'bg-gray-100 text-gray-800';
                
                queueList.innerHTML += `
                    <div class="bg-white rounded-lg shadow-lg p-6 hover-scale">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-2xl font-bold text-theme-primary">${item.queueNumber}</h3>
                                <p class="font-semibold">${item.customerName}</p>
                                <p class="text-gray-600 text-sm">${item.customerPhone}</p>
                            </div>
                            <span class="px-3 py-1 rounded-full text-sm font-semibold ${statusColor}">
                                ${item.status}
                            </span>
                        </div>
                        <div class="text-sm text-gray-500">
                            <p>${new Date(item.createdAt).toLocaleString('id-ID')}</p>
                        </div>
                    </div>
                `;
            });
        }
        
        // ... Sisa fungsi admin (handleLogin, showAdminPanel, dll) tetap sama, tidak perlu diubah.
        // Cukup salin sisa kode dari file asli Anda ke sini.
        // Pastikan Anda menyalin dari `function showLoginModal()` hingga akhir script.
    
        function showLoginModal() {
            document.getElementById('loginModal').classList.remove('hidden');
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.add('hidden');
        }

        function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            const data = db.getData();
            const user = data.users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                closeLoginModal();
                showAdminPanel();
                showToast('success', 'Login Berhasil', `Selamat datang, ${user.fullName}`);
            } else {
                showToast('error', 'Login Gagal', 'Username atau password salah');
            }
        }

        function showAdminPanel() {
            document.getElementById('adminPanel').classList.remove('hidden');
            showAdminSection('dashboard');
            loadAdminData();
        }

        function logoutAdmin() {
            currentUser = null;
            document.getElementById('adminPanel').classList.add('hidden');
            showToast('success', 'Logout Berhasil', 'Anda telah keluar dari panel admin');
        }

        function showAdminSection(section) {
            document.querySelectorAll('.admin-section').forEach(sec => {
                sec.classList.add('hidden');
            });
            const sectionEl = document.getElementById('admin' + section.charAt(0).toUpperCase() + section.slice(1));
            sectionEl.classList.remove('hidden');
            
            document.querySelectorAll('.admin-nav-btn').forEach(btn => {
                btn.classList.remove('bg-gray-700');
            });
            
            const clickedBtn = Array.from(document.querySelectorAll('.admin-nav-btn')).find(btn => btn.getAttribute('onclick').includes(section));
            if(clickedBtn) {
                 clickedBtn.classList.add('bg-gray-700');
            }

            document.getElementById('adminSectionTitle').textContent = clickedBtn.textContent.trim();

            loadAdminSectionData(section);
            
            const sidebar = document.getElementById('adminSidebar');
            if (window.innerWidth < 768 && !sidebar.classList.contains('-translate-x-full')) {
                sidebar.classList.add('-translate-x-full');
            }
        }

        function loadAdminData() {
            const data = db.getData();
            
            document.getElementById('totalOrders').textContent = data.orders.length;
            document.getElementById('activeQueue').textContent = data.queue.filter(q => q.status === 'waiting').length;
            document.getElementById('totalProducts').textContent = data.products.length;
            
            const totalRevenue = data.orders
                .filter(o => o.status === 'paid' || o.status === 'completed')
                .reduce((sum, o) => sum + o.totalAmount, 0);
            document.getElementById('totalRevenue').textContent = `Rp ${totalRevenue.toLocaleString()}`;
        }

        function loadAdminSectionData(section) {
            const data = db.getData();
            
            switch(section) {
                case 'orders': loadOrdersTable(); break;
                case 'queue': loadAdminQueue(); break;
                case 'products': loadAdminProducts(); break;
                case 'users': loadUsersTable(); break;
                case 'settings': loadSettingsForm(); break;
                case 'reports': loadReportsSection(); break;
            }
        }
        
        // ... (Fungsi-fungsi sisanya tidak perlu diubah, bisa disalin langsung)

	function loadOrdersTable() {
            const data = db.getData();
            const ordersTable = document.getElementById('ordersTable');
            
            ordersTable.innerHTML = '';
            data.orders.sort((a, b) => b.id - a.id).forEach(order => {
                const statusColor = {
                    'pending': 'bg-yellow-100 text-yellow-800',
                    'paid': 'bg-blue-100 text-blue-800',
                    'completed': 'bg-green-100 text-green-800',
                    'cancelled': 'bg-red-100 text-red-800'
                }[order.status] || 'bg-gray-100 text-gray-800';
                
                ordersTable.innerHTML += `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">${order.orderNumber}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">${order.customerName}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">Rp ${order.totalAmount.toLocaleString()}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 rounded-full text-xs font-semibold ${statusColor}">
                                ${order.status}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex space-x-2">
                                ${order.status === 'pending' ? `<button onclick="confirmPayment(${order.id})" class="text-green-600 hover:text-green-800"><i class="fas fa-check"></i></button>` : ''}
                                ${order.status === 'paid' ? `<button onclick="addToQueue(${order.id})" class="text-blue-600 hover:text-blue-800"><i class="fas fa-users"></i></button>` : ''}
                                ${order.status === 'waiting' ? `<button onclick="callCustomer(${order.id})" class="text-purple-600 hover:text-purple-800"><i class="fas fa-bullhorn"></i></button>` : ''}
                                <button onclick="deleteOrder(${order.id})" class="text-red-600 hover:text-red-800"><i class="fas fa-trash"></i></button>
                            </div>
                        </td>
                    </tr>
                `;
            });
        }

        function confirmPayment(orderId) {
            const data = db.getData();
            const order = data.orders.find(o => o.id === orderId);
            if (order) {
                order.status = 'paid';
                db.saveData(data);
                loadOrdersTable();
                showToast('success', 'Berhasil', 'Pembayaran telah dikonfirmasi');
            }
        }

        function addToQueue(orderId) {
            const data = db.getData();
            const order = data.orders.find(o => o.id === orderId);
            if (order) {
                const queueItem = {
                    id: Date.now(),
                    queueNumber: generateQueueNumber(),
                    orderId: order.id,
                    customerName: order.customerName,
                    customerPhone: order.customerPhone,
                    status: 'waiting',
                    createdAt: new Date().toISOString()
                };
                data.queue.push(queueItem);
                order.status = 'waiting';
                db.saveData(data);
                loadOrdersTable();
                loadAdminQueue();
                showToast('success', 'Berhasil', 'Pesanan ditambahkan ke antrian');
            }
        }

        function callCustomer(orderId) {
            const data = db.getData();
            const queueItem = data.queue.find(q => q.orderId === orderId);
            if (queueItem) {
                queueItem.status = 'called';
                db.saveData(data);
                loadAdminQueue();
                showToast('success', 'Berhasil', 'Pelanggan telah dipanggil');
            }
        }

        function deleteOrder(orderId) {
            if (confirm('Apakah Anda yakin ingin menghapus pesanan ini?')) {
                const data = db.getData();
                data.orders = data.orders.filter(o => o.id !== orderId);
                db.saveData(data);
                loadOrdersTable();
                showToast('success', 'Berhasil', 'Pesanan telah dihapus');
            }
        }

        function loadAdminQueue() {
            const data = db.getData();
            const adminQueueList = document.getElementById('adminQueueList');
            
            adminQueueList.innerHTML = '';
            data.queue.sort((a, b) => a.id - b.id).forEach(item => {
                const statusColor = {
                    'waiting': 'bg-yellow-100 text-yellow-800',
                    'called': 'bg-blue-100 text-blue-800',
                    'completed': 'bg-green-100 text-green-800',
                    'cancelled': 'bg-red-100 text-red-800'
                }[item.status] || 'bg-gray-100 text-gray-800';
                
                adminQueueList.innerHTML += `
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-2xl font-bold text-purple-600">${item.queueNumber}</h3>
                                <p class="font-semibold">${item.customerName}</p>
                                <p class="text-gray-600 text-sm">${item.customerPhone}</p>
                            </div>
                            <span class="px-3 py-1 rounded-full text-sm font-semibold ${statusColor}">
                                ${item.status}
                            </span>
                        </div>
                        <div class="flex space-x-2">
                            ${item.status === 'waiting' ? `<button onclick="callCustomer(${item.orderId})" class="flex-1 bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition text-sm"><i class="fas fa-bullhorn mr-2"></i>Panggil</button>` : ''}
                            ${item.status === 'called' ? `<button onclick="completeQueue(${item.id})" class="flex-1 bg-green-600 text-white py-2 rounded hover:bg-green-700 transition text-sm"><i class="fas fa-check mr-2"></i>Selesai</button>` : ''}
                            <button onclick="deleteQueue(${item.id})" class="bg-red-600 text-white px-3 py-2 rounded hover:bg-red-700 transition">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
        }

        function completeQueue(queueId) {
            const data = db.getData();
            const queueItem = data.queue.find(q => q.id === queueId);
            if (queueItem) {
                queueItem.status = 'completed';
                const order = data.orders.find(o => o.id === queueItem.orderId);
                if (order) {
                    order.status = 'completed';
                }
                db.saveData(data);
                loadAdminQueue();
                loadOrdersTable();
                showToast('success', 'Berhasil', 'Antrian telah diselesaikan');
            }
        }

        function deleteQueue(queueId) {
            if (confirm('Apakah Anda yakin ingin menghapus antrian ini?')) {
                const data = db.getData();
                data.queue = data.queue.filter(q => q.id !== queueId);
                db.saveData(data);
                loadAdminQueue();
                showToast('success', 'Berhasil', 'Antrian telah dihapus');
            }
        }

        function loadAdminProducts() {
            const data = db.getData();
            const adminProductsList = document.getElementById('adminProductsList');
            
            adminProductsList.innerHTML = '';
            data.products.forEach(product => {
                adminProductsList.innerHTML += `
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <div class="h-32 bg-gradient-to-br from-purple-400 to-blue-500 rounded-lg mb-4 flex items-center justify-center">
                            <i class="fas fa-coffee text-white text-3xl"></i>
                        </div>
                        <h3 class="font-semibold text-lg mb-2">${product.name}</h3>
                        <p class="text-gray-600 text-sm mb-2 h-10 overflow-hidden">${product.description}</p>
                        <p class="text-purple-600 font-bold mb-2">Rp ${product.price.toLocaleString()}</p>
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-sm font-semibold ${product.available ? 'text-green-600' : 'text-red-600'}">
                                ${product.available ? 'Tersedia' : 'Habis'}
                            </span>
                            <span class="text-sm bg-gray-100 px-2 py-1 rounded font-semibold">${product.category}</span>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="editProduct(${product.id})" class="flex-1 bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteProduct(${product.id})" class="bg-red-600 text-white px-3 py-2 rounded hover:bg-red-700 transition">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
        }

        function showProductModal() {
            document.getElementById('productModal').classList.remove('hidden');
            document.getElementById('productModalTitle').textContent = 'Tambah Produk';
            document.getElementById('productName').value = '';
            document.getElementById('productCategory').value = 'coffee';
            document.getElementById('productDescription').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('productStatus').value = 'true';
            editingProductId = null;
        }

        function closeProductModal() {
            document.getElementById('productModal').classList.add('hidden');
        }

        function editProduct(productId) {
            const data = db.getData();
            const product = data.products.find(p => p.id === productId);
            if (product) {
                document.getElementById('productModal').classList.remove('hidden');
                document.getElementById('productModalTitle').textContent = 'Edit Produk';
                document.getElementById('productName').value = product.name;
                document.getElementById('productCategory').value = product.category;
                document.getElementById('productDescription').value = product.description;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productStatus').value = product.available.toString();
                editingProductId = productId;
            }
        }

        function saveProduct(event) {
            event.preventDefault();
            
            const data = db.getData();
            const productData = {
                name: document.getElementById('productName').value,
                category: document.getElementById('productCategory').value,
                description: document.getElementById('productDescription').value,
                price: parseInt(document.getElementById('productPrice').value),
                available: document.getElementById('productStatus').value === 'true'
            };
            
            if (editingProductId) {
                const product = data.products.find(p => p.id === editingProductId);
                Object.assign(product, productData);
            } else {
                productData.id = Date.now();
                data.products.push(productData);
            }
            
            db.saveData(data);
            loadAdminProducts();
            loadProducts();
            closeProductModal();
            showToast('success', 'Berhasil', `Produk telah ${editingProductId ? 'diperbarui' : 'ditambahkan'}`);
        }

        function deleteProduct(productId) {
            if (confirm('Apakah Anda yakin ingin menghapus produk ini?')) {
                const data = db.getData();
                data.products = data.products.filter(p => p.id !== productId);
                db.saveData(data);
                loadAdminProducts();
                loadProducts();
                showToast('success', 'Berhasil', 'Produk telah dihapus');
            }
        }

        function loadUsersTable() {
            const data = db.getData();
            const usersTable = document.getElementById('usersTable');
            
            usersTable.innerHTML = '';
            data.users.forEach(user => {
                usersTable.innerHTML += `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">${user.fullName}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">${user.username}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 rounded-full text-xs font-semibold ${user.role === 'superadmin' ? 'bg-purple-100 text-purple-800' : 'bg-gray-100 text-gray-800'}">
                                ${user.role}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex space-x-2">
                                <button onclick="editUser(${user.id})" class="text-blue-600 hover:text-blue-800">
                                    <i class="fas fa-edit"></i>
                                </button>
                                ${user.id !== 1 ? `<button onclick="deleteUser(${user.id})" class="text-red-600 hover:text-red-800"><i class="fas fa-trash"></i></button>` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            });
        }

        function showUserModal() {
            document.getElementById('userModal').classList.remove('hidden');
            document.getElementById('userModalTitle').textContent = 'Tambah Admin';
            document.getElementById('userFullName').value = '';
            document.getElementById('userUsername').value = '';
            document.getElementById('userPassword').value = '';
            document.getElementById('userRole').value = 'admin';
            editingUserId = null;
        }

        function closeUserModal() {
            document.getElementById('userModal').classList.add('hidden');
        }

        function editUser(userId) {
            const data = db.getData();
            const user = data.users.find(u => u.id === userId);
            if (user) {
                document.getElementById('userModal').classList.remove('hidden');
                document.getElementById('userModalTitle').textContent = 'Edit Admin';
                document.getElementById('userFullName').value = user.fullName;
                document.getElementById('userUsername').value = user.username;
                document.getElementById('userPassword').value = user.password;
                document.getElementById('userRole').value = user.role;
                editingUserId = userId;
            }
        }

        function saveUser(event) {
            event.preventDefault();
            
            const data = db.getData();
            const userData = {
                username: document.getElementById('userUsername').value,
                password: document.getElementById('userPassword').value,
                fullName: document.getElementById('userFullName').value,
                role: document.getElementById('userRole').value
            };
            
            if (editingUserId) {
                const user = data.users.find(u => u.id === editingUserId);
                Object.assign(user, userData);
            } else {
                userData.id = Date.now();
                data.users.push(userData);
            }
            
            db.saveData(data);
            loadUsersTable();
            closeUserModal();
            showToast('success', 'Berhasil', `Admin telah ${editingUserId ? 'diperbarui' : 'ditambahkan'}`);
        }

        function deleteUser(userId) {
            if (confirm('Apakah Anda yakin ingin menghapus admin ini?')) {
                const data = db.getData();
                data.users = data.users.filter(u => u.id !== userId);
                db.saveData(data);
                loadUsersTable();
                showToast('success', 'Berhasil', 'Admin telah dihapus');
            }
        }

        function loadSettingsForm() {
            const data = db.getData();
            const settings = data.settings;
            
            document.getElementById('settingsMerchantName').value = settings.merchantName;
            document.getElementById('settingsJumbotronTitle').value = settings.jumbotronTitle;
            document.getElementById('settingsJumbotronSubtitle').value = settings.jumbotronSubtitle;
            document.getElementById('settingsAddress').value = settings.address;
            document.getElementById('settingsPhone').value = settings.phone;
            document.getElementById('settingsEmail').value = settings.email;
            document.getElementById('settingsHours').value = settings.hours;
            
            const paymentMethodsContainer = document.getElementById('settingsPaymentMethods');
            paymentMethodsContainer.innerHTML = '';
            
            settings.paymentMethods.forEach(method => {
                paymentMethodsContainer.innerHTML += `
                    <label class="flex items-center space-x-2">
                        <input type="checkbox" class="form-checkbox" ${method.active ? 'checked' : ''} onchange="togglePaymentMethod('${method.id}', this.checked)">
                        <i class="fas ${method.icon} text-purple-600"></i>
                        <span>${method.name}</span>
                    </label>
                `;
            });
        }

        function togglePaymentMethod(methodId, active) {
            const data = db.getData();
            const method = data.settings.paymentMethods.find(m => m.id === methodId);
            if (method) {
                method.active = active;
                db.saveData(data);
            }
        }

        function saveSettings(event) {
            event.preventDefault();
            
            const data = db.getData();
            data.settings = {
                ...data.settings,
                merchantName: document.getElementById('settingsMerchantName').value,
                jumbotronTitle: document.getElementById('settingsJumbotronTitle').value,
                jumbotronSubtitle: document.getElementById('settingsJumbotronSubtitle').value,
                address: document.getElementById('settingsAddress').value,
                phone: document.getElementById('settingsPhone').value,
                email: document.getElementById('settingsEmail').value,
                hours: document.getElementById('settingsHours').value
            };
            
            db.saveData(data);
            loadSettings();
            showToast('success', 'Berhasil', 'Pengaturan telah disimpan');
        }

        function loadReportsSection() {
            const today = new Date();
            const lastWeek = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            
            document.getElementById('reportStartDate').value = lastWeek.toISOString().split('T')[0];
            document.getElementById('reportEndDate').value = today.toISOString().split('T')[0];
            
            generateReport();
        }

        function generateReport() {
            const startDate = new Date(document.getElementById('reportStartDate').value);
            const endDate = new Date(document.getElementById('reportEndDate').value);
            endDate.setHours(23, 59, 59, 999);
            
            const data = db.getData();
            const filteredOrders = data.orders.filter(order => {
                const orderDate = new Date(order.createdAt);
                return orderDate >= startDate && orderDate <= endDate;
            });
            
            const totalOrders = filteredOrders.length;
            const totalRevenue = filteredOrders
                .filter(o => o.status === 'paid' || o.status === 'completed')
                .reduce((sum, o) => sum + o.totalAmount, 0);
            
            const paymentMethods = {};
            filteredOrders.forEach(order => {
                paymentMethods[order.paymentMethod] = (paymentMethods[order.paymentMethod] || 0) + 1;
            });
            
            const reportContent = document.getElementById('reportContent');
            reportContent.innerHTML = `
                <div class="mb-6">
                    <h3 class="text-xl font-semibold mb-4">Ringkasan Laporan</h3>
                    <div class="grid md:grid-cols-3 gap-4">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <p class="text-blue-600 font-semibold">Total Pesanan</p>
                            <p class="text-2xl font-bold">${totalOrders}</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <p class="text-green-600 font-semibold">Total Pendapatan</p>
                            <p class="text-2xl font-bold">Rp ${totalRevenue.toLocaleString()}</p>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg">
                            <p class="text-purple-600 font-semibold">Rata-rata</p>
                            <p class="text-2xl font-bold">Rp ${totalOrders > 0 ? Math.round(totalRevenue / totalOrders).toLocaleString() : 0}</p>
                        </div>
                    </div>
                </div>
                
                <div class="mb-6">
                    <h3 class="text-xl font-semibold mb-4">Metode Pembayaran</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        ${Object.entries(paymentMethods).map(([method, count]) => `
                            <div class="bg-gray-50 p-4 rounded-lg text-center">
                                <p class="font-semibold">${method}</p>
                                <p class="text-2xl font-bold">${count}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div>
                    <h3 class="text-xl font-semibold mb-4">Detail Pesanan</h3>
                    <div id="reportTableContainer" class="overflow-x-auto">
                        <table class="w-full border-collapse border border-gray-300">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="border border-gray-300 px-4 py-2">No. Pesanan</th>
                                    <th class="border border-gray-300 px-4 py-2">Tanggal</th>
                                    <th class="border border-gray-300 px-4 py-2">Pelanggan</th>
                                    <th class="border border-gray-300 px-4 py-2">Total</th>
                                    <th class="border border-gray-300 px-4 py-2">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${filteredOrders.map(order => `
                                    <tr>
                                        <td class="border border-gray-300 px-4 py-2">${order.orderNumber}</td>
                                        <td class="border border-gray-300 px-4 py-2">${new Date(order.createdAt).toLocaleDateString('id-ID')}</td>
                                        <td class="border border-gray-300 px-4 py-2">${order.customerName}</td>
                                        <td class="border border-gray-300 px-4 py-2">Rp ${order.totalAmount.toLocaleString()}</td>
                                        <td class="border border-gray-300 px-4 py-2">${order.status}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function printReport() {
            // *** BAGIAN YANG DIUBAH DIMULAI DI SINI ***

            // 1. Ambil data terbaru dari database
            const data = db.getData();
            const merchantName = data.settings.merchantName;

            // Create a new window for printing
            const printWindow = window.open('', '_blank');
            
            // Get the table container directly
            const tableContainer = document.getElementById('reportTableContainer');
            
            // Get date range for title
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            
            // Create print-friendly HTML
            const printHTML = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Laporan Transaksi ${merchantName}</title>
                    <style>
                        body { 
                            font-family: Arial, sans-serif; 
                            margin: 20px; 
                            color: #000;
                            background: white;
                        }
                        h1 { 
                            text-align: center; 
                            margin-bottom: 10px;
                            color: #000;
                            font-size: 18px;
                            font-weight: bold;
                        }
                        h2 { 
                            text-align: center; 
                            margin-bottom: 20px;
                            color: #000;
                            font-size: 14px;
                        }
                        h3 { 
                            text-align: center; 
                            margin-bottom: 15px;
                            color: #000;
                            font-size: 14px;
                            font-weight: bold;
                        }
                        table { 
                            width: 100%; 
                            border-collapse: collapse; 
                            margin-top: 10px;
                        }
                        th, td { 
                            border: 1px solid #000; 
                            padding: 6px; 
                            text-align: left;
                            font-size: 12px;
                        }
                        th { 
                            background-color: #f5f5f5; 
                            font-weight: bold;
                        }
                        .no-print { 
                            display: none; 
                        }
                        @media print {
                            body { margin: 10px; }
                            h1 { font-size: 16px; }
                            h2 { font-size: 12px; }
                            h3 { font-size: 12px; }
                            th, td { padding: 4px; font-size: 10px; }
                            table { font-size: 10px; }
                        }
                    </style>
                </head>
                <body>
                    <h1>LAPORAN TRANSAKSI ${merchantName.toUpperCase()}</h1>
                    <h2>Periode: ${formatDate(startDate)} - ${formatDate(endDate)}</h2>
                    <h3>DETAIL PESANAN</h3>
                    ${tableContainer ? tableContainer.innerHTML : '<p>Tidak ada data untuk ditampilkan</p>'}
                </body>
                </html>
            `;
            
            // Write content to print window
            printWindow.document.write(printHTML);
            printWindow.document.close();
            
            // Wait for content to load, then print
            printWindow.onload = function() {
                printWindow.focus();
                printWindow.print();
                printWindow.close();
            };

            // *** BAGIAN YANG DIUBAH BERAKHIR DI SINI ***
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
        }

        function exportOrdersReport() {
            const data = db.getData();
            const csvContent = [
                ['No. Pesanan', 'Tanggal', 'Pelanggan', 'Telepon', 'Total', 'Metode Pembayaran', 'Status'],
                ...data.orders.map(order => [
                    order.orderNumber,
                    new Date(order.createdAt).toLocaleDateString('id-ID'),
                    order.customerName,
                    order.customerPhone,
                    order.totalAmount,
                    order.paymentMethod,
                    order.status
                ])
            ].map(row => row.join(',')).join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `laporan_pesanan_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            showToast('success', 'Berhasil', 'Laporan telah diunduh');
        }

        function downloadDatabase() {
            const notepadContent = db.exportToNotepad();
            const blob = new Blob([notepadContent], { type: 'text/plain;charset=utf-8;' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `kopiku_database_${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            showToast('success', 'Berhasil', 'Database telah diunduh');
        }

        // Contact Form
        function sendContactMessage(event) {
            event.preventDefault();
            
            const data = db.getData();
            const message = {
                id: Date.now(),
                name: event.target[0].value,
                email: event.target[1].value,
                message: event.target[2].value,
                createdAt: new Date().toISOString()
            };
            
            data.messages.push(message);
            db.saveData(data);
            
            event.target.reset();
            showToast('success', 'Berhasil', 'Pesan Anda telah terkirim');
        }

        // Toast Notification
        function showToast(type, title, message) {
            const toast = document.getElementById('toast');
            const toastIcon = document.getElementById('toastIcon');
            const toastTitle = document.getElementById('toastTitle');
            const toastMessage = document.getElementById('toastMessage');
            
            const icons = {
                success: '<i class="fas fa-check-circle text-green-500 text-xl"></i>',
                error: '<i class="fas fa-exclamation-circle text-red-500 text-xl"></i>',
                warning: '<i class="fas fa-exclamation-triangle text-yellow-500 text-xl"></i>',
                info: '<i class="fas fa-info-circle text-blue-500 text-xl"></i>'
            };
            
            toastIcon.innerHTML = icons[type] || icons.info;
            toastTitle.textContent = title;
            toastMessage.textContent = message;
            
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

        // Initialize category filter
        document.addEventListener('DOMContentLoaded', function() {
            filterProducts('all');
        });
    </script>
</body>
</html>
