<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KopiKu - Coffee Shop Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        :root {
            --theme-primary: #8B5CF6;
            --theme-primary-hover: #7C3AED;
            --theme-text: #8B5CF6;
            --theme-gradient-from: #8B5CF6;
            --theme-gradient-to: #2563EB;
        }
        body { font-family: 'Poppins', sans-serif; }
        .bg-theme-primary { background-color: var(--theme-primary); }
        .hover\:bg-theme-primary-hover:hover { background-color: var(--theme-primary-hover); }
        .text-theme-primary { color: var(--theme-text); }
        .border-theme-primary { border-color: var(--theme-primary); }
        .gradient-theme { background-image: linear-gradient(to right, var(--theme-gradient-from), var(--theme-gradient-to)); }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .slide-in { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateY(-10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .hover-scale { transition: transform 0.2s; }
        .hover-scale:hover { transform: scale(1.02); }
        .loading-spinner { border: 3px solid #f3f3f3; border-top: 3px solid var(--theme-primary); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .print-only { display: none; }
        @media print { .print-only { display: block; } .no-print { display: none; } }
    </style>
</head>
<body class="bg-gray-50">
    <div id="loadingScreen" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-gray-600">Memuat aplikasi...</p>
        </div>
    </div>

    <div id="app" class="min-h-screen">
        <header class="bg-white shadow-lg sticky top-0 z-40">
            <div class="container mx-auto px-4 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-coffee text-theme-primary text-2xl"></i>
                        <h1 class="text-xl md:text-2xl font-bold text-gray-800" id="merchantName">KopiKu Coffee Shop</h1>
                    </div>
                    <nav class="hidden md:flex items-center space-x-4">
                        <button onclick="showPage('home')" class="nav-btn text-gray-600 hover:text-theme-primary transition"><i class="fas fa-home mr-2"></i>Beranda</button>
                        <button onclick="showPage('menu')" class="nav-btn text-gray-600 hover:text-theme-primary transition"><i class="fas fa-coffee mr-2"></i>Menu</button>
                        <button onclick="showPage('queue')" class="nav-btn text-gray-600 hover:text-theme-primary transition"><i class="fas fa-users mr-2"></i>Antrian</button>
                        <button onclick="showPage('contact')" class="nav-btn text-gray-600 hover:text-theme-primary transition"><i class="fas fa-phone mr-2"></i>Kontak</button>
                        <button onclick="showLoginModal()" class="bg-theme-primary text-white px-4 py-2 rounded-lg hover:bg-theme-primary-hover transition"><i class="fas fa-user-shield mr-2"></i>Admin</button>
                    </nav>
                    <div class="md:hidden">
                         <button onclick="showLoginModal()" class="bg-theme-primary text-white px-3 py-2 rounded-lg hover:bg-theme-primary-hover transition"><i class="fas fa-user-shield"></i></button>
                    </div>
                </div>
            </div>
        </header>

        <section id="jumbotron" class="relative gradient-theme text-white py-20">
            <div class="container mx-auto px-4 text-center">
                <h2 class="text-4xl md:text-5xl font-bold mb-4" id="jumbotronTitle">Selamat Datang di KopiKu</h2>
                <p class="text-lg md:text-xl mb-8" id="jumbotronSubtitle">Nikmati kopi terbaik dengan suasana yang nyaman</p>
                <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                    <button onclick="showPage('menu')" class="bg-white text-theme-primary px-8 py-3 rounded-full font-semibold hover:bg-gray-100 transition hover-scale"><i class="fas fa-shopping-cart mr-2"></i>Pesan Sekarang</button>
                    <button onclick="showPage('queue')" class="border-2 border-white text-white px-8 py-3 rounded-full font-semibold hover:bg-white hover:text-theme-primary transition hover-scale"><i class="fas fa-users mr-2"></i>Lihat Antrian</button>
                </div>
            </div>
        </section>

        <main class="container mx-auto px-4 py-8">
            <div id="homePage" class="page-content">
                <div class="grid md:grid-cols-3 gap-8 mb-12">
                    <div class="bg-white p-6 rounded-xl shadow-lg hover-scale"><div class="text-theme-primary text-4xl mb-4"><i class="fas fa-coffee"></i></div><h3 class="text-xl font-semibold mb-2">Kopi Premium</h3><p class="text-gray-600">100% kopi pilihan dengan kualitas terbaik</p></div>
                    <div class="bg-white p-6 rounded-xl shadow-lg hover-scale"><div class="text-theme-primary text-4xl mb-4"><i class="fas fa-wifi"></i></div><h3 class="text-xl font-semibold mb-2">WiFi Gratis</h3><p class="text-gray-600">Nikmati koneksi internet cepat dan gratis</p></div>
                    <div class="bg-white p-6 rounded-xl shadow-lg hover-scale"><div class="text-theme-primary text-4xl mb-4"><i class="fas fa-couch"></i></div><h3 class="text-xl font-semibold mb-2">Ruangan Nyaman</h3><p class="text-gray-600">Suasana cozy yang bikin betah berlama-lama</p></div>
                </div>
                <div class="mb-12"><h2 class="text-3xl font-bold text-center mb-8">Produk Unggulan</h2><div id="featuredProducts" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6"></div></div>
            </div>
            <div id="menuPage" class="page-content hidden">
                <h2 class="text-3xl font-bold mb-8 text-center">Menu Kami</h2>
                <div class="flex justify-center mb-8"><div class="bg-white rounded-lg shadow-md p-1 inline-flex flex-wrap"><button onclick="filterProducts('all')" class="category-btn px-4 py-2 sm:px-6 rounded-md transition" data-category="all">Semua</button><button onclick="filterProducts('coffee')" class="category-btn px-4 py-2 sm:px-6 rounded-md transition" data-category="coffee">Kopi</button><button onclick="filterProducts('food')" class="category-btn px-4 py-2 sm:px-6 rounded-md transition" data-category="food">Makanan</button><button onclick="filterProducts('dessert')" class="category-btn px-4 py-2 sm:px-6 rounded-md transition" data-category="dessert">Dessert</button><button onclick="filterProducts('other')" class="category-btn px-4 py-2 sm:px-6 rounded-md transition" data-category="other">Lainnya</button></div></div>
                <div id="productsGrid" class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6 mb-8"></div>
                <button id="cartFab" onclick="showCartModal()" class="fixed bottom-20 md:bottom-8 right-8 bg-theme-primary text-white w-16 h-16 rounded-full shadow-lg flex items-center justify-center text-2xl hover:bg-theme-primary-hover transition z-30"><i class="fas fa-shopping-cart"></i><span id="cartItemCountBadge" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full h-6 w-6 flex items-center justify-center hidden">0</span></button>
            </div>
            <div id="queuePage" class="page-content hidden"><h2 class="text-3xl font-bold mb-8 text-center">Antrian Saat Ini</h2><div id="queueList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div></div>
            <div id="contactPage" class="page-content hidden"><div class="max-w-4xl mx-auto"><h2 class="text-3xl font-bold mb-8 text-center">Hubungi Kami</h2><div class="grid md:grid-cols-2 gap-8"><div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="text-xl font-semibold mb-4">Informasi Kontak</h3><div class="space-y-3"><div class="flex items-center"><i class="fas fa-map-marker-alt text-theme-primary w-6"></i><span id="contactAddress"></span></div><div class="flex items-center"><i class="fas fa-phone text-theme-primary w-6"></i><span id="contactPhone"></span></div><div class="flex items-center"><i class="fas fa-envelope text-theme-primary w-6"></i><span id="contactEmail"></span></div><div class="flex items-center"><i class="fas fa-clock text-theme-primary w-6"></i><span id="contactHours"></span></div></div></div><div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="text-xl font-semibold mb-4">Kirim Pesan</h3><form onsubmit="sendContactMessage(event)" class="space-y-4"><input type="text" placeholder="Nama Anda" class="w-full p-3 border rounded-lg" required><input type="email" placeholder="Email Anda" class="w-full p-3 border rounded-lg" required><textarea placeholder="Pesan Anda" rows="4" class="w-full p-3 border rounded-lg" required></textarea><button type="submit" class="w-full bg-theme-primary text-white py-3 rounded-lg hover:bg-theme-primary-hover transition"><i class="fas fa-paper-plane mr-2"></i>Kirim Pesan</button></form></div></div></div></div>
             <div class="md:hidden fixed bottom-0 left-0 right-0 bg-white shadow-lg z-40"><nav class="flex justify-around py-2"><button onclick="showPage('home')" class="nav-btn flex flex-col items-center text-gray-600 hover:text-theme-primary transition"><i class="fas fa-home text-xl"></i><span class="text-xs">Beranda</span></button><button onclick="showPage('menu')" class="nav-btn flex flex-col items-center text-gray-600 hover:text-theme-primary transition"><i class="fas fa-coffee text-xl"></i><span class="text-xs">Menu</span></button><button onclick="showPage('queue')" class="nav-btn flex flex-col items-center text-gray-600 hover:text-theme-primary transition"><i class="fas fa-users text-xl"></i><span class="text-xs">Antrian</span></button><button onclick="showPage('contact')" class="nav-btn flex flex-col items-center text-gray-600 hover:text-theme-primary transition"><i class="fas fa-phone text-xl"></i><span class="text-xs">Kontak</span></button></nav></div>
        </main>
        <footer class="bg-gray-800 text-white py-8 mt-16 pb-20 md:pb-8"><div class="container mx-auto px-4 text-center"><p>&copy; 2025 <span id="footerMerchantName">KopiKu</span>. All rights reserved.</p><div class="mt-4 flex justify-center space-x-4"><a href="#" class="hover:text-theme-primary transition"><i class="fab fa-facebook"></i></a><a href="#" class="hover:text-theme-primary transition"><i class="fab fa-instagram"></i></a><a href="#" class="hover:text-theme-primary transition"><i class="fab fa-twitter"></i></a></div></div></footer>
    </div>

    <div id="cartModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4"><div class="bg-white rounded-xl p-6 w-full max-w-sm slide-in"><div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-bold">Keranjang</h2><button onclick="closeCartModal()" class="text-2xl text-gray-500 hover:text-gray-800">&times;</button></div><div id="modalCartItems" class="mb-4 max-h-64 overflow-y-auto pr-2"></div><div class="border-t pt-4"><div class="flex justify-between font-bold text-lg mb-4"><span>Total</span><span id="modalCartTotal">Rp 0</span></div><div class="flex space-x-4"><button onclick="closeCartModal()" class="flex-1 bg-gray-300 text-gray-800 py-3 rounded-lg hover:bg-gray-400 transition">Tutup</button><button onclick="proceedToCheckout()" class="flex-1 bg-theme-primary text-white py-3 rounded-lg hover:bg-theme-primary-hover transition">Checkout</button></div></div></div></div>
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4"><div class="bg-white rounded-xl p-8 w-full max-w-sm slide-in"><h2 class="text-2xl font-bold mb-6 text-center">Login Admin</h2><form onsubmit="handleLogin(event)" class="space-y-4"><div><label class="block text-sm font-medium mb-2">Username</label><input type="text" id="loginUsername" class="w-full p-3 border rounded-lg" required></div><div><label class="block text-sm font-medium mb-2">Password</label><input type="password" id="loginPassword" class="w-full p-3 border rounded-lg" required></div><button type="submit" class="w-full bg-theme-primary text-white py-3 rounded-lg hover:bg-theme-primary-hover transition"><i class="fas fa-sign-in-alt mr-2"></i>Login</button></form><button onclick="closeLoginModal()" class="w-full mt-4 text-gray-600 hover:text-gray-800 transition">Batal</button></div></div>
    <div id="checkoutModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4"><div class="bg-white rounded-xl p-6 md:p-8 w-full max-w-2xl max-h-[90vh] overflow-y-auto slide-in"><h2 class="text-2xl font-bold mb-6">Checkout</h2><form onsubmit="processCheckout(event)" class="space-y-4"><div class="grid md:grid-cols-2 gap-4"><div><label class="block text-sm font-medium mb-2">Nama Lengkap</label><input type="text" id="customerName" class="w-full p-3 border rounded-lg" required></div><div><label class="block text-sm font-medium mb-2">Nomor Telepon</label><input type="tel" id="customerPhone" class="w-full p-3 border rounded-lg" required></div></div><div><label class="block text-sm font-medium mb-2">Email (Opsional)</label><input type="email" id="customerEmail" class="w-full p-3 border rounded-lg"></div><div><label class="block text-sm font-medium mb-2">Metode Pembayaran</label><div id="paymentMethods" class="grid grid-cols-2 gap-4"></div></div><div><label class="block text-sm font-medium mb-2">Catatan (Opsional)</label><textarea id="orderNotes" rows="3" class="w-full p-3 border rounded-lg"></textarea></div><div class="border-t pt-4"><div class="flex justify-between text-lg md:text-xl font-bold mb-4"><span>Total Pembayaran:</span><span id="checkoutTotal">Rp 0</span></div><div class="flex space-x-4"><button type="button" onclick="closeCheckoutModal()" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400 transition">Batal</button><button type="submit" class="flex-1 bg-theme-primary text-white py-3 rounded-lg hover:bg-theme-primary-hover transition"><i class="fas fa-check mr-2"></i>Proses Pesanan</button></div></div></form></div></div>
    
    <div id="adminPanel" class="fixed inset-0 bg-gray-100 z-50 hidden">
        <div class="flex h-screen relative">
            <div id="adminSidebar" class="absolute inset-y-0 left-0 w-64 bg-gray-800 text-white transform -translate-x-full md:relative md:translate-x-0 transition-all duration-300 ease-in-out z-30"><div class="p-4"><h2 class="text-xl font-bold mb-6">Admin Panel</h2><nav class="space-y-2"><button onclick="showAdminSection('dashboard')" class="admin-nav-btn w-full flex items-center justify-start p-3 rounded hover:bg-gray-700 transition"><i class="fas fa-tachometer-alt mr-2"></i><span class="nav-text">Dashboard</span></button><button onclick="showAdminSection('orders')" class="admin-nav-btn w-full flex items-center justify-start p-3 rounded hover:bg-gray-700 transition"><i class="fas fa-shopping-cart mr-2"></i><span class="nav-text">Pesanan</span></button><button onclick="showAdminSection('queue')" class="admin-nav-btn w-full flex items-center justify-start p-3 rounded hover:bg-gray-700 transition"><i class="fas fa-users mr-2"></i><span class="nav-text">Antrian</span></button><button onclick="showAdminSection('products')" class="admin-nav-btn w-full flex items-center justify-start p-3 rounded hover:bg-gray-700 transition"><i class="fas fa-box mr-2"></i><span class="nav-text">Produk</span></button><button onclick="showAdminSection('users')" class="admin-nav-btn w-full flex items-center justify-start p-3 rounded hover:bg-gray-700 transition"><i class="fas fa-user-cog mr-2"></i><span class="nav-text">Pengguna</span></button><button onclick="showAdminSection('settings')" class="admin-nav-btn w-full flex items-center justify-start p-3 rounded hover:bg-gray-700 transition"><i class="fas fa-cog mr-2"></i><span class="nav-text">Pengaturan</span></button><button onclick="showAdminSection('reports')" class="admin-nav-btn w-full flex items-center justify-start p-3 rounded hover:bg-gray-700 transition"><i class="fas fa-chart-bar mr-2"></i><span class="nav-text">Laporan</span></button><button onclick="downloadDatabase()" class="admin-nav-btn w-full flex items-center justify-start p-3 rounded hover:bg-gray-700 transition"><i class="fas fa-download mr-2"></i><span class="nav-text">Download DB</span></button><button onclick="logoutAdmin()" class="admin-nav-btn w-full flex items-center justify-start p-3 rounded hover:bg-red-600 transition"><i class="fas fa-sign-out-alt mr-2"></i><span class="nav-text">Logout</span></button></nav></div></div>
            <div class="flex-1 overflow-y-auto">
                 <div class="bg-white shadow-md p-4 flex justify-between items-center sticky top-0 z-20"><button id="sidebarToggle" class="text-gray-800"><i class="fas fa-bars fa-lg"></i></button><h1 class="font-bold text-lg" id="adminSectionTitle">Dashboard</h1></div>
                <div class="p-6">
                    <div id="adminDashboard" class="admin-section"><h1 class="text-3xl font-bold mb-6 hidden md:block">Dashboard</h1><div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"><div onclick="showAdminSection('orders')" class="bg-white p-6 rounded-lg shadow cursor-pointer hover:shadow-xl transition-shadow"><div class="flex items-center justify-between"><div><p class="text-gray-600">Total Pesanan</p><p class="text-2xl font-bold" id="totalOrders">0</p></div><i class="fas fa-shopping-cart text-theme-primary text-2xl"></i></div></div><div onclick="showAdminSection('queue')" class="bg-white p-6 rounded-lg shadow cursor-pointer hover:shadow-xl transition-shadow"><div class="flex items-center justify-between"><div><p class="text-gray-600">Antrian Aktif</p><p class="text-2xl font-bold" id="activeQueue">0</p></div><i class="fas fa-users text-blue-600 text-2xl"></i></div></div><div onclick="showAdminSection('products')" class="bg-white p-6 rounded-lg shadow cursor-pointer hover:shadow-xl transition-shadow"><div class="flex items-center justify-between"><div><p class="text-gray-600">Total Produk</p><p class="text-2xl font-bold" id="totalProducts">0</p></div><i class="fas fa-box text-green-600 text-2xl"></i></div></div><div class="bg-white p-6 rounded-lg shadow"><div class="flex items-center justify-between"><div><p class="text-gray-600">Pendapatan</p><p class="text-2xl font-bold" id="totalRevenue">Rp 0</p></div><i class="fas fa-money-bill text-yellow-600 text-2xl"></i></div></div></div></div>
                    <div id="adminOrders" class="admin-section hidden"><div class="flex justify-between items-center mb-6"><h1 class="text-3xl font-bold hidden md:block">Manajemen Pesanan</h1><button onclick="exportOrdersReport()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition text-sm"><i class="fas fa-file-excel mr-2"></i>Export</button></div><div class="bg-white rounded-lg shadow overflow-x-auto"><table class="w-full"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">No. Pesanan</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Pelanggan</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Total</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Aksi</th></tr></thead><tbody id="ordersTable" class="bg-white divide-y divide-gray-200"></tbody></table></div><div id="adminOrdersPagination" class="mt-4 flex flex-col sm:flex-row justify-between items-center w-full gap-2"></div></div>
                    <div id="adminQueue" class="admin-section hidden"><h1 class="text-3xl font-bold mb-6 hidden md:block">Manajemen Antrian</h1><div id="adminQueueList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div></div>
                    <div id="adminProducts" class="admin-section hidden"><div class="flex justify-between items-center mb-6"><h1 class="text-3xl font-bold hidden md:block">Manajemen Produk</h1><button onclick="showProductModal()" class="bg-theme-primary text-white px-4 py-2 rounded-lg hover:bg-theme-primary-hover transition"><i class="fas fa-plus mr-2"></i>Tambah</button></div><div class="bg-white rounded-lg shadow overflow-x-auto"><table class="w-full"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">No</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nama Produk</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Kategori</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Harga</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Aksi</th></tr></thead><tbody id="adminProductsTable" class="bg-white divide-y divide-gray-200"></tbody></table></div><div id="adminProductsPagination" class="mt-4 flex flex-col sm:flex-row justify-between items-center w-full gap-2"></div></div>
                    <div id="adminUsers" class="admin-section hidden"><div class="flex justify-between items-center mb-6"><h1 class="text-3xl font-bold hidden md:block">Manajemen Pengguna</h1><button onclick="showUserModal()" class="bg-theme-primary text-white px-4 py-2 rounded-lg hover:bg-theme-primary-hover transition"><i class="fas fa-plus mr-2"></i>Tambah</button></div><div class="bg-white rounded-lg shadow overflow-x-auto"><table class="w-full"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nama</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Username</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Role</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Aksi</th></tr></thead><tbody id="usersTable" class="bg-white divide-y divide-gray-200"></tbody></table></div><div id="adminUsersPagination" class="mt-4 flex flex-col sm:flex-row justify-between items-center w-full gap-2"></div></div>
                    <div id="adminSettings" class="admin-section hidden"><h1 class="text-3xl font-bold mb-6 hidden md:block">Pengaturan</h1><div class="bg-white rounded-lg shadow p-6"><form onsubmit="saveSettings(event)" class="space-y-6"><div><label class="block text-sm font-medium mb-2">Nama Merchant</label><input type="text" id="settingsMerchantName" class="w-full p-3 border rounded-lg"></div><div><label class="block text-sm font-medium mb-2">Jumbotron Title</label><input type="text" id="settingsJumbotronTitle" class="w-full p-3 border rounded-lg"></div><div><label class="block text-sm font-medium mb-2">Jumbotron Subtitle</label><input type="text" id="settingsJumbotronSubtitle" class="w-full p-3 border rounded-lg"></div><div><label class="block text-sm font-medium mb-2">Alamat</label><input type="text" id="settingsAddress" class="w-full p-3 border rounded-lg"></div><div><label class="block text-sm font-medium mb-2">Telepon</label><input type="text" id="settingsPhone" class="w-full p-3 border rounded-lg"></div><div><label class="block text-sm font-medium mb-2">Email</label><input type="email" id="settingsEmail" class="w-full p-3 border rounded-lg"></div><div><label class="block text-sm font-medium mb-2">Jam Operasional</label><input type="text" id="settingsHours" class="w-full p-3 border rounded-lg"></div><div><label class="block text-sm font-medium mb-2">Metode Pembayaran Aktif</label><div id="settingsPaymentMethods" class="space-y-2"></div></div><div class="border-t pt-6"><label class="block text-lg font-semibold mb-4">Tema Warna</label><div class="flex flex-wrap items-center gap-4"><button type="button" onclick="applyTheme('purple')" class="w-8 h-8 rounded-full bg-purple-500 border-2 border-white shadow"></button><button type="button" onclick="applyTheme('brown')" class="w-8 h-8 rounded-full bg-amber-700 border-2 border-white shadow"></button><button type="button" onclick="applyTheme('red')" class="w-8 h-8 rounded-full bg-red-600 border-2 border-white shadow"></button><button type="button" onclick="applyTheme('black')" class="w-8 h-8 rounded-full bg-gray-800 border-2 border-white shadow"></button><div class="relative"><label for="customColorPicker" class="cursor-pointer"><div class="w-8 h-8 rounded-full border-2 border-white shadow flex items-center justify-center bg-gray-200"><i class="fas fa-palette"></i></div><input type="color" id="customColorPicker" class="absolute top-0 left-0 w-full h-full opacity-0 cursor-pointer"></label><span class="ml-2 text-sm text-gray-600">Kustom</span></div></div></div><button type="submit" class="bg-theme-primary text-white px-6 py-3 rounded-lg hover:bg-theme-primary-hover transition"><i class="fas fa-save mr-2"></i>Simpan Pengaturan</button></form></div></div>
                    <div id="adminReports" class="admin-section hidden"><div class="flex flex-col md:flex-row justify-between md:items-center mb-6 gap-4"><h1 class="text-3xl font-bold hidden md:block">Laporan</h1><div class="flex flex-wrap gap-2"><input type="date" id="reportStartDate" class="p-2 border rounded-lg"><input type="date" id="reportEndDate" class="p-2 border rounded-lg"><button onclick="generateReport()" class="bg-theme-primary text-white px-4 py-2 rounded-lg hover:bg-theme-primary-hover transition"><i class="fas fa-search mr-2"></i>Generate</button><button onclick="printReport()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition"><i class="fas fa-print mr-2"></i>Print</button></div></div><div class="bg-white rounded-lg shadow p-6"><div id="reportContent"></div></div></div>
                </div>
            </div>
        </div>
    </div>
    <div id="productModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4"><div class="bg-white rounded-xl p-6 md:p-8 w-full max-w-2xl slide-in max-h-[90vh] overflow-y-auto"><h2 class="text-2xl font-bold mb-6" id="productModalTitle">Tambah Produk</h2><form onsubmit="saveProduct(event)" class="space-y-4"><div class="grid md:grid-cols-2 gap-4"><div><label class="block text-sm font-medium mb-2">Nama Produk</label><input type="text" id="productName" class="w-full p-3 border rounded-lg" required></div><div><label class="block text-sm font-medium mb-2">Kategori</label><select id="productCategory" class="w-full p-3 border rounded-lg" required><option value="coffee">Kopi</option><option value="food">Makanan</option><option value="dessert">Dessert</option><option value="other">Lainnya</option></select></div></div><div><label class="block text-sm font-medium mb-2">Deskripsi</label><textarea id="productDescription" rows="3" class="w-full p-3 border rounded-lg"></textarea></div><div class="grid md:grid-cols-2 gap-4"><div><label class="block text-sm font-medium mb-2">Harga</label><input type="number" id="productPrice" class="w-full p-3 border rounded-lg" required></div><div><label class="block text-sm font-medium mb-2">Status</label><select id="productStatus" class="w-full p-3 border rounded-lg"><option value="true">Tersedia</option><option value="false">Tidak Tersedia</option></select></div></div><div class="flex space-x-4"><button type="button" onclick="closeProductModal()" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400 transition">Batal</button><button type="submit" class="flex-1 bg-theme-primary text-white py-3 rounded-lg hover:bg-theme-primary-hover transition"><i class="fas fa-save mr-2"></i>Simpan</button></div></form></div></div>
    <div id="userModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4"><div class="bg-white rounded-xl p-8 w-full max-w-md slide-in"><h2 class="text-2xl font-bold mb-6" id="userModalTitle">Tambah Admin</h2><form onsubmit="saveUser(event)" class="space-y-4"><div><label class="block text-sm font-medium mb-2">Nama Lengkap</label><input type="text" id="userFullName" class="w-full p-3 border rounded-lg" required></div><div><label class="block text-sm font-medium mb-2">Username</label><input type="text" id="userUsername" class="w-full p-3 border rounded-lg" required></div><div><label class="block text-sm font-medium mb-2">Password</label><input type="password" id="userPassword" class="w-full p-3 border rounded-lg" required></div><div><label class="block text-sm font-medium mb-2">Role</label><select id="userRole" class="w-full p-3 border rounded-lg"><option value="admin">Admin</option><option value="superadmin">Super Admin</option></select></div><div class="flex space-x-4"><button type="button" onclick="closeUserModal()" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400 transition">Batal</button><button type="submit" class="flex-1 bg-theme-primary text-white py-3 rounded-lg hover:bg-theme-primary-hover transition"><i class="fas fa-save mr-2"></i>Simpan</button></div></form></div></div>
    <div id="toast" class="fixed bottom-24 md:bottom-4 right-4 z-50 hidden"><div class="bg-white rounded-lg shadow-xl p-4 flex items-center space-x-3 slide-in"><div id="toastIcon"></div><div><p id="toastTitle" class="font-semibold"></p><p id="toastMessage" class="text-sm text-gray-600"></p></div></div></div>

    <script>
    // --- [PENTING] BAGIAN SCRIPT UTAMA APLIKASI ---

    // --- PENGATURAN AWAL ---
    class Database {
        constructor() { this.initializeDatabase(); }
        initializeDatabase() {
            if (localStorage.getItem('kopiku_database')) return;
            
            // --- [PENTING] UBAH DATA AWAL PRODUK, PENGGUNA, DAN PENGATURAN DI SINI ---
            const initialData = {
                settings: {
                    merchantName: 'KopiKu',
                    jumbotronTitle: 'Selamat Datang di KopiKu',
                    jumbotronSubtitle: 'Nikmati kopi terbaik dengan suasana yang nyaman',
                    address: 'Jl. Kopi No. 123, Jakarta',
                    phone: '+62 812-3456-7890',
                    email: 'info@kopiku.com',
                    hours: 'Senin - Minggu: 08:00 - 22:00',
                    paymentMethods: [
                        { id: 'cash', name: 'Tunai', icon: 'fa-money-bill', active: true },
                        { id: 'qris', name: 'QRIS', icon: 'fa-qrcode', active: true },
                        { id: 'transfer', name: 'Transfer Bank', icon: 'fa-university', active: false }
                    ],
                    theme: 'purple'
                },
                products: [
                    { id: 1, name: 'Espresso', category: 'coffee', description: 'Kopi klasik yang kuat', price: 15000, available: true },
                    { id: 2, name: 'Cappuccino', category: 'coffee', description: 'Espresso dengan susu foam', price: 25000, available: true },
                    { id: 3, name: 'Caffe Latte', category: 'coffee', description: 'Espresso dengan susu panas', price: 28000, available: true },
                    { id: 4, name: 'Americano', category: 'coffee', description: 'Espresso dengan air panas', price: 20000, available: true },
                    { id: 5, name: 'Chocolate Cake', category: 'dessert', description: 'Kue coklat lembut', price: 30000, available: true },
                    { id: 6, name: 'Croissant', category: 'food', description: 'Pastry buttery dari Perancis', price: 22000, available: true },
                    { id: 7, name: 'Sandwich', category: 'food', description: 'Roti lapis dengan isi', price: 35000, available: true },
                    { id: 8, name: 'Ice Cream', category: 'dessert', description: 'Es krim premium', price: 18000, available: true },
                    { id: 9, name: 'Kopi Susu Gula Aren', category: 'coffee', description: 'Kopi susu kekinian', price: 22000, available: true },
                    { id: 10, name: 'Red Velvet Latte', category: 'other', description: 'Minuman non-kopi', price: 27000, available: true },
                    { id: 11, name: 'Matcha Latte', category: 'other', description: 'Teh hijau dengan susu', price: 27000, available: true },
                    { id: 12, name: 'Donat Coklat', category: 'dessert', description: 'Donat empuk', price: 10000, available: true }
                ],
                orders: [],
                queue: [],
                users: [ { id: 1, username: 'admin', password: 'admin', fullName: 'Administrator', role: 'superadmin' } ],
                messages: []
            };
            localStorage.setItem('kopiku_database', JSON.stringify(initialData));
        }
        getData() { return JSON.parse(localStorage.getItem('kopiku_database')); }
        saveData(data) { localStorage.setItem('kopiku_database', JSON.stringify(data)); }
    }

    // --- VARIABEL GLOBAL & STATE MANAJEMEN ---
    const db = new Database();
    let currentUser = null;
    let cart = [];
    let currentFilter = 'all';
    let editingProductId = null;
    let editingUserId = null;
    const itemsPerPage = 10;
    let productsCurrentPage = 1;
    let ordersCurrentPage = 1;
    let usersCurrentPage = 1;

    // --- FUNGSI INISIALISASI APLIKASI ---
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(() => {
            document.getElementById('loadingScreen').style.display = 'none';
            initializeApp();
        }, 500);
        setupEventListeners();
    });

    function initializeApp() {
        loadTheme();
        loadSettings();
        loadProducts();
        loadQueue();
        updateCart();
        setActiveNav('home');
    }

    function setupEventListeners() {
        const adminContent = document.querySelector('#adminPanel .flex-1.overflow-y-auto');
        const sidebar = document.getElementById('adminSidebar');
        const toggleButton = document.getElementById('sidebarToggle');
        
        if (toggleButton) {
            toggleButton.addEventListener('click', (event) => {
                event.stopPropagation();
                if (window.innerWidth < 768) {
                    sidebar.classList.toggle('-translate-x-full');
                } else {
                    sidebar.classList.toggle('w-64');
                    sidebar.classList.toggle('w-20');
                    sidebar.querySelector('h2').classList.toggle('hidden');
                    sidebar.querySelectorAll('.nav-text').forEach(text => text.classList.toggle('hidden'));
                    sidebar.querySelectorAll('.admin-nav-btn').forEach(btn => {
                        btn.querySelector('i').classList.toggle('mr-2');
                        btn.classList.toggle('justify-start');
                        btn.classList.toggle('justify-center');
                    });
                }
            });
        }

        if(adminContent) {
            adminContent.addEventListener('click', () => {
                if (window.innerWidth < 768 && !sidebar.classList.contains('-translate-x-full')) {
                    sidebar.classList.add('-translate-x-full');
                }
            });
        }

        const customColorPicker = document.getElementById('customColorPicker');
        if (customColorPicker) {
            customColorPicker.addEventListener('input', (event) => applyCustomTheme(event.target.value));
        }
    }

    // --- FUNGSI TEMA & TAMPILAN ---
    const themes = {
        purple: { primary: '#8B5CF6', hover: '#7C3AED', text: '#8B5CF6', from: '#8B5CF6', to: '#2563EB' },
        brown: { primary: '#a16207', hover: '#854d0e', text: '#a16207', from: '#a16207', to: '#b45309' },
        red: { primary: '#dc2626', hover: '#b91c1c', text: '#dc2626', from: '#dc2626', to: '#ef4444' },
        black: { primary: '#1f2937', hover: '#111827', text: '#1f2937', from: '#1f2937', to: '#4b5563' }
    };

    function setCssVariables(colors) {
        const root = document.documentElement;
        Object.keys(colors).forEach(key => {
            const cssVar = `--theme-${key.replace(/([A-Z])/g, '-$1').toLowerCase()}`;
            root.style.setProperty(cssVar, colors[key]);
        });
    }

    function applyTheme(themeName) {
        const themeColors = themes[themeName];
        if (themeColors) {
            setCssVariables(themeColors);
            const data = db.getData();
            data.settings.theme = themeName;
            db.saveData(data);
        }
    }

    function generateColorShades(hex) {
        let r = parseInt(hex.slice(1, 3), 16), g = parseInt(hex.slice(3, 5), 16), b = parseInt(hex.slice(5, 7), 16);
        const darken = (c) => Math.max(0, Math.floor(c * 0.85)).toString(16).padStart(2, '0');
        const shift = (c1, c2) => Math.min(255, Math.floor(c1 * 1.2 + c2 * 0.2)).toString(16).padStart(2, '0');
        return { primary: hex, hover: `#${darken(r)}${darken(g)}${darken(b)}`, text: hex, from: hex, to: `#${shift(r,b)}${shift(g,r)}${shift(b,g)}` };
    }

    function applyCustomTheme(hexColor) {
        const shades = generateColorShades(hexColor);
        setCssVariables(shades);
        const data = db.getData();
        data.settings.theme = hexColor;
        db.saveData(data);
    }

    function loadTheme() {
        const data = db.getData();
        const savedTheme = data.settings.theme || 'purple';
        if (savedTheme.startsWith('#')) {
            applyCustomTheme(savedTheme);
            document.getElementById('customColorPicker').value = savedTheme;
        } else {
            applyTheme(savedTheme);
        }
    }

    // --- FUNGSI TAMPILAN UTAMA (NAVIGASI & MEMUAT DATA) ---
    function showPage(pageId) {
        document.querySelectorAll('.page-content').forEach(page => page.classList.add('hidden'));
        document.getElementById(pageId + 'Page').classList.remove('hidden');
        window.scrollTo(0, 0);
        setActiveNav(pageId);
    }

    function setActiveNav(pageId) {
        document.querySelectorAll('.nav-btn').forEach(btn => {
            const isMatch = btn.onclick.toString().includes(`'${pageId}'`);
            btn.classList.toggle('text-theme-primary', isMatch);
            btn.classList.toggle('text-gray-600', !isMatch);
        });
    }

    function loadSettings() {
        const { settings } = db.getData();
        document.title = settings.merchantName;
        document.getElementById('merchantName').textContent = settings.merchantName;
        document.getElementById('jumbotronTitle').textContent = settings.jumbotronTitle;
        document.getElementById('jumbotronSubtitle').textContent = settings.jumbotronSubtitle;
        document.getElementById('contactAddress').textContent = settings.address;
        document.getElementById('contactPhone').textContent = settings.phone;
        document.getElementById('contactEmail').textContent = settings.email;
        document.getElementById('contactHours').textContent = settings.hours;
        document.getElementById('footerMerchantName').textContent = settings.merchantName;
    }

    function loadProducts() {
        const { products } = db.getData();
        // --- OPTIMASI: Bangun HTML string lalu render sekali
        const featuredHtml = products.slice(0, 4).map(createProductCard).join('');
        document.getElementById('featuredProducts').innerHTML = featuredHtml;
        const allProductsHtml = products.map(createProductCard).join('');
        document.getElementById('productsGrid').innerHTML = allProductsHtml;
    }
    
    // --- [PENTING] FUNGSI INI MENGATUR TAMPILAN KARTU PRODUK ---
    function createProductCard(product) {
        const isAvailable = product.available;
        return `
            <div class="bg-white rounded-lg shadow-lg overflow-hidden hover-scale product-card ${isAvailable ? 'cursor-pointer' : ''}" 
                 data-category="${product.category}" 
                 onclick="${isAvailable ? `addToCart(${product.id})` : ''}">
                <div class="h-48 gradient-theme flex items-center justify-center"><i class="fas fa-coffee text-white text-4xl"></i></div>
                <div class="p-4">
                    <h3 class="font-semibold text-lg mb-2">${product.name}</h3>
                    <p class="text-gray-600 text-sm mb-3 h-10 overflow-hidden">${product.description}</p>
                    <div class="flex justify-between items-center">
                        <span class="text-theme-primary font-bold">Rp ${product.price.toLocaleString()}</span>
                        <button onclick="event.stopPropagation(); ${isAvailable ? `addToCart(${product.id})` : ''}" 
                                class="bg-theme-primary text-white px-3 py-1 rounded-lg hover:bg-theme-primary-hover transition ${!isAvailable ? 'opacity-50 cursor-not-allowed' : ''}" 
                                ${!isAvailable ? 'disabled' : ''}>
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
            </div>
        `;
    }

    function loadQueue() {
        const { queue } = db.getData();
        const queueList = document.getElementById('queueList');
        // --- OPTIMASI: Bangun HTML string lalu render sekali
        if (queue.length === 0) {
            queueList.innerHTML = '<p class="text-center text-gray-500 col-span-full">Tidak ada antrian saat ini</p>';
            return;
        }
        const queueHtml = queue.sort((a, b) => a.id - b.id).map(item => {
            const statusStyles = {
                'waiting': 'bg-yellow-100 text-yellow-800',
                'called': 'bg-blue-100 text-blue-800',
                'completed': 'bg-green-100 text-green-800',
                'cancelled': 'bg-red-100 text-red-800'
            };
            return `
                <div class="bg-white rounded-lg shadow-lg p-6 hover-scale">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-2xl font-bold text-theme-primary">${item.queueNumber}</h3>
                            <p class="font-semibold">${item.customerName}</p>
                        </div>
                        <span class="px-3 py-1 rounded-full text-sm font-semibold ${statusStyles[item.status] || 'bg-gray-100'}">${item.status}</span>
                    </div>
                </div>`;
        }).join('');
        queueList.innerHTML = queueHtml;
    }

    // --- FUNGSI KERANJANG & CHECKOUT ---
    function addToCart(productId) {
        const data = db.getData();
        const product = data.products.find(p => p.id === productId);
        if (!product.available) {
            showToast('error', 'Maaf', 'Produk sedang tidak tersedia');
            return;
        }
        const existingItem = cart.find(item => item.id === productId);
        if (existingItem) {
            existingItem.quantity++;
        } else {
            cart.push({ ...product, quantity: 1 });
        }
        updateCart();
        showToast('success', 'Berhasil', `${product.name} ditambahkan`);
    }

    function updateCart() {
        const badge = document.getElementById('cartItemCountBadge');
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        badge.textContent = totalItems;
        badge.classList.toggle('hidden', totalItems === 0);
    }

    function proceedToCheckout() {
        if (cart.length === 0) {
            showToast('error', 'Error', 'Keranjang belanja kosong');
            return;
        }
        closeCartModal();
        showCheckoutModal();
    }
    
    // --- FUNGSI PANEL ADMIN ---
    function showAdminSection(section) {
        document.querySelectorAll('.admin-section').forEach(sec => sec.classList.add('hidden'));
        document.getElementById(`admin${section.charAt(0).toUpperCase() + section.slice(1)}`).classList.remove('hidden');
        document.querySelectorAll('.admin-nav-btn').forEach(btn => btn.classList.remove('bg-gray-700'));
        const clickedBtn = Array.from(document.querySelectorAll('.admin-nav-btn')).find(btn => btn.getAttribute('onclick').includes(section));
        if (clickedBtn) {
            clickedBtn.classList.add('bg-gray-700');
            document.getElementById('adminSectionTitle').textContent = clickedBtn.querySelector('.nav-text').textContent.trim();
        }
        loadAdminSectionData(section);
        const sidebar = document.getElementById('adminSidebar');
        if (window.innerWidth < 768 && !sidebar.classList.contains('-translate-x-full')) {
            sidebar.classList.add('-translate-x-full');
        }
    }
    
    // --- [PENTING] BAGIAN INI MEMUAT DATA UNTUK SETIAP HALAMAN ADMIN ---
    function loadAdminSectionData(section) {
        switch(section) {
            case 'orders': ordersCurrentPage = 1; loadOrdersTable(); break;
            case 'queue': loadAdminQueue(); break;
            case 'products': productsCurrentPage = 1; loadAdminProducts(); break;
            case 'users': usersCurrentPage = 1; loadUsersTable(); break;
            case 'settings': loadSettingsForm(); break;
            case 'reports': loadReportsSection(); break;
        }
    }
    
    function loadOrdersTable() {
        const { orders } = db.getData();
        const sortedOrders = orders.sort((a, b) => b.id - a.id);
        const ordersTable = document.getElementById('ordersTable');

        const startIndex = (ordersCurrentPage - 1) * itemsPerPage;
        const paginatedOrders = sortedOrders.slice(startIndex, startIndex + itemsPerPage);

        // --- OPTIMASI: Bangun HTML string lalu render sekali
        const tableHtml = paginatedOrders.map(order => {
             const statusStyles = {'pending': 'bg-yellow-100 text-yellow-800','paid': 'bg-blue-100 text-blue-800','completed': 'bg-green-100 text-green-800','cancelled': 'bg-red-100 text-red-800'};
            return `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">${order.orderNumber}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">${order.customerName}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">Rp ${order.totalAmount.toLocaleString()}</td>
                    <td class="px-6 py-4 whitespace-nowrap"><span class="px-2 py-1 rounded-full text-xs font-semibold ${statusStyles[order.status] || ''}">${order.status}</span></td>
                    <td class="px-6 py-4 whitespace-nowrap"><div class="flex space-x-2">${order.status === 'pending' ? `<button onclick="confirmPayment(${order.id})" class="text-green-600 hover:text-green-800"><i class="fas fa-check"></i></button>` : ''}${order.status === 'paid' ? `<button onclick="addToQueue(${order.id})" class="text-blue-600 hover:text-blue-800"><i class="fas fa-users"></i></button>` : ''}<button onclick="deleteOrder(${order.id})" class="text-red-600 hover:text-red-800"><i class="fas fa-trash"></i></button></div></td>
                </tr>`;
        }).join('');
        ordersTable.innerHTML = tableHtml;
        renderPagination('adminOrdersPagination', ordersCurrentPage, orders.length, 'changeOrdersPage');
    }

    function loadAdminProducts() {
        const { products } = db.getData();
        const adminProductsTable = document.getElementById('adminProductsTable');
        const startIndex = (productsCurrentPage - 1) * itemsPerPage;
        const paginatedProducts = products.slice(startIndex, startIndex + itemsPerPage);
        
        // --- OPTIMASI: Bangun HTML string lalu render sekali
        const tableHtml = paginatedProducts.map((product, index) => `
            <tr>
                <td class="px-6 py-4 text-sm">${startIndex + index + 1}</td>
                <td class="px-6 py-4 text-sm font-medium">${product.name}</td>
                <td class="px-6 py-4 text-sm">${product.category}</td>
                <td class="px-6 py-4 text-sm">Rp ${product.price.toLocaleString()}</td>
                <td class="px-6 py-4"><span class="px-2 py-1 rounded-full text-xs font-semibold ${product.available ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">${product.available ? 'Tersedia' : 'Habis'}</span></td>
                <td class="px-6 py-4"><div class="flex space-x-2"><button onclick="editProduct(${product.id})" class="text-blue-600 hover:text-blue-800"><i class="fas fa-edit"></i></button><button onclick="deleteProduct(${product.id})" class="text-red-600 hover:text-red-800"><i class="fas fa-trash"></i></button></div></td>
            </tr>
        `).join('');
        adminProductsTable.innerHTML = tableHtml;
        renderPagination('adminProductsPagination', productsCurrentPage, products.length, 'changeProductsPage');
    }

    function loadUsersTable() {
        const { users } = db.getData();
        const usersTable = document.getElementById('usersTable');
        const startIndex = (usersCurrentPage - 1) * itemsPerPage;
        const paginatedUsers = users.slice(startIndex, startIndex + itemsPerPage);
        
        // --- OPTIMASI: Bangun HTML string lalu render sekali
        const tableHtml = paginatedUsers.map(user => `
            <tr>
                <td class="px-6 py-4 text-sm">${user.fullName}</td>
                <td class="px-6 py-4 text-sm">${user.username}</td>
                <td class="px-6 py-4"><span class="px-2 py-1 rounded-full text-xs font-semibold ${user.role === 'superadmin' ? 'bg-purple-100 text-purple-800' : 'bg-gray-100 text-gray-800'}">${user.role}</span></td>
                <td class="px-6 py-4"><div class="flex space-x-2"><button onclick="editUser(${user.id})" class="text-blue-600 hover:text-blue-800"><i class="fas fa-edit"></i></button>${user.id !== 1 ? `<button onclick="deleteUser(${user.id})" class="text-red-600 hover:text-red-800"><i class="fas fa-trash"></i></button>` : ''}</div></td>
            </tr>
        `).join('');
        usersTable.innerHTML = tableHtml;
        renderPagination('adminUsersPagination', usersCurrentPage, users.length, 'changeUsersPage');
    }
    
    // --- [PENTING] FUNGSI PAGINASI UMUM UNTUK SEMUA TABEL ---
    function renderPagination(containerId, currentPage, totalItems, changePageFn) {
        const paginationContainer = document.getElementById(containerId);
        const totalPages = Math.ceil(totalItems / itemsPerPage);
        paginationContainer.innerHTML = '';
        if (totalPages <= 1) return;

        paginationContainer.innerHTML = `
            <button onclick="${changePageFn}(-1)" class="w-full sm:w-auto bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 disabled:opacity-50" ${currentPage === 1 ? 'disabled' : ''}>
                Sebelumnya
            </button>
            <span class="text-sm font-semibold my-2 sm:my-0">
                Halaman ${currentPage} dari ${totalPages}
            </span>
            <button onclick="${changePageFn}(1)" class="w-full sm:w-auto bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 disabled:opacity-50" ${currentPage === totalPages ? 'disabled' : ''}>
                Berikutnya
            </button>
        `;
    }

    function changeOrdersPage(direction) { ordersCurrentPage += direction; loadOrdersTable(); }
    function changeProductsPage(direction) { productsCurrentPage += direction; loadAdminProducts(); }
    function changeUsersPage(direction) { usersCurrentPage += direction; loadUsersTable(); }
    
    // --- FUNGSI MODAL & NOTIFIKASI (TIDAK PERLU SERING DIUBAH) ---
    function showProductModal() { document.getElementById('productModal').classList.remove('hidden'); editingProductId = null; document.getElementById('productModalTitle').textContent = 'Tambah Produk'; document.querySelector('#productModal form').reset(); }
    function closeProductModal() { document.getElementById('productModal').classList.add('hidden'); }
    function showUserModal() { document.getElementById('userModal').classList.remove('hidden'); editingUserId = null; document.getElementById('userModalTitle').textContent = 'Tambah Admin'; document.querySelector('#userModal form').reset(); }
    function closeUserModal() { document.getElementById('userModal').classList.add('hidden'); }
    function showLoginModal() { document.getElementById('loginModal').classList.remove('hidden'); }
    function closeLoginModal() { document.getElementById('loginModal').classList.add('hidden'); }
    function showCartModal() { document.getElementById('cartModal').classList.remove('hidden'); /* ... Logika render item ... */ }
    function closeCartModal() { document.getElementById('cartModal').classList.add('hidden'); }
    function showCheckoutModal() { document.getElementById('checkoutModal').classList.remove('hidden'); /* ... Logika render checkout ... */ }
    function closeCheckoutModal() { document.getElementById('checkoutModal').classList.add('hidden'); }
    function showToast(type, title, message) {
        const toast = document.getElementById('toast');
        const icons = { success: 'fa-check-circle text-green-500', error: 'fa-exclamation-circle text-red-500', };
        document.getElementById('toastIcon').innerHTML = `<i class="fas ${icons[type] || 'fa-info-circle text-blue-500'} text-xl"></i>`;
        document.getElementById('toastTitle').textContent = title;
        document.getElementById('toastMessage').textContent = message;
        toast.classList.remove('hidden');
        setTimeout(() => toast.classList.add('hidden'), 3000);
    }

    // --- Sisa fungsi-fungsi lain yang tidak diubah ---
    // (Fungsi saveProduct, deleteProduct, saveUser, deleteUser, dll. tetap sama)
    function saveProduct(event) { event.preventDefault(); const data=db.getData(); const productData={name:document.getElementById('productName').value, category:document.getElementById('productCategory').value, description:document.getElementById('productDescription').value, price:parseInt(document.getElementById('productPrice').value), available:document.getElementById('productStatus').value==='true'}; if (editingProductId) { const productIndex=data.products.findIndex(p=>p.id===editingProductId); data.products[productIndex]={...data.products[productIndex], ...productData}; } else { productData.id=Date.now(); data.products.push(productData); } db.saveData(data); loadAdminProducts(); loadProducts(); closeProductModal(); showToast('success', 'Berhasil', `Produk telah ${editingProductId?'diperbarui':'ditambahkan'}`); }
    function deleteProduct(productId) { if (confirm('Yakin hapus produk ini?')) { const data=db.getData(); data.products=data.products.filter(p=>p.id!==productId); db.saveData(data); productsCurrentPage=1; loadAdminProducts(); loadProducts(); showToast('success', 'Berhasil', 'Produk dihapus'); } }
    function editProduct(productId) { const data=db.getData(); const product=data.products.find(p=>p.id===productId); if (product) { showProductModal(); document.getElementById('productModalTitle').textContent='Edit Produk'; document.getElementById('productName').value=product.name; document.getElementById('productCategory').value=product.category; document.getElementById('productDescription').value=product.description; document.getElementById('productPrice').value=product.price; document.getElementById('productStatus').value=product.available.toString(); editingProductId=productId; } }
    function saveUser(event) { event.preventDefault(); const data=db.getData(); const userData={username:document.getElementById('userUsername').value, password:document.getElementById('userPassword').value, fullName:document.getElementById('userFullName').value, role:document.getElementById('userRole').value}; if (editingUserId) { const user=data.users.find(u=>u.id===editingUserId); Object.assign(user, userData); } else { userData.id=Date.now(); data.users.push(userData); } db.saveData(data); loadUsersTable(); closeUserModal(); showToast('success', 'Berhasil', `Admin telah ${editingUserId?'diperbarui':'ditambahkan'}`); }
    function deleteUser(userId) { if (confirm('Yakin hapus admin ini?')) { const data=db.getData(); data.users=data.users.filter(u=>u.id!==userId); db.saveData(data); usersCurrentPage=1; loadUsersTable(); showToast('success', 'Berhasil', 'Admin dihapus'); } }
    function editUser(userId) { const data=db.getData(); const user=data.users.find(u=>u.id===userId); if (user) { showUserModal(); document.getElementById('userModalTitle').textContent='Edit Admin'; document.getElementById('userFullName').value=user.fullName; document.getElementById('userUsername').value=user.username; document.getElementById('userPassword').value=user.password; document.getElementById('userRole').value=user.role; editingUserId=userId; } }
    
    </script>
</body>
</html>
